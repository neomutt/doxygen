<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NeoMutt: conn/openssl.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="https://neomutt.org"><img alt="Logo" src="neomutt-64.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <a style="color: black; text-decoration: none;" href="https://neomutt.org">
   <div id="projectname">NeoMutt
   &#160;<span id="projectnumber">2021-02-05-647-g5d4e00</span>
   </div>
   <div id="projectbrief">Teaching an old dog new tricks</div>
   </a>
   <a href="https://github.com/neomutt/neomutt" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#000000; color:#fff; position: fixed; top: 0; border: 0; right: 0; z-index: 9999;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  </td>
   <td><a style="text-decoration: none; position: absolute; right: 0; top: 25px; margin-right: 100px; color: #66d866; font-size: 400%;" href="http://www.doxygen.org/index.html">DOXYGEN</a></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('openssl_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">openssl.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Handling of OpenSSL encryption.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;config.h&quot;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;openssl/asn1.h&gt;</code><br />
<code>#include &lt;openssl/bio.h&gt;</code><br />
<code>#include &lt;openssl/err.h&gt;</code><br />
<code>#include &lt;openssl/evp.h&gt;</code><br />
<code>#include &lt;openssl/obj_mac.h&gt;</code><br />
<code>#include &lt;openssl/opensslv.h&gt;</code><br />
<code>#include &lt;openssl/ossl_typ.h&gt;</code><br />
<code>#include &lt;openssl/pem.h&gt;</code><br />
<code>#include &lt;openssl/rand.h&gt;</code><br />
<code>#include &lt;openssl/safestack.h&gt;</code><br />
<code>#include &lt;openssl/ssl.h&gt;</code><br />
<code>#include &lt;openssl/x509.h&gt;</code><br />
<code>#include &lt;openssl/x509v3.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;strings.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="conn_2private_8h_source.html">private.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mutt_2lib_8h_source.html">mutt/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="address_2lib_8h_source.html">address/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_2lib_8h_source.html">config/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="core_2lib_8h_source.html">core/lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="conn_2lib_8h_source.html">lib.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mutt__logging_8h_source.html">mutt_logging.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ssl_8h_source.html">ssl.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for openssl.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c__incl.svg" width="3438" height="187"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="openssl_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a42856d46ab73f3511a5353d4e30af6d4"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a42856d46ab73f3511a5353d4e30af6d4">STACK_OF</a> (X509)</td></tr>
<tr class="memdesc:a42856d46ab73f3511a5353d4e30af6d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">SSL socket data -.  <a href="#a42856d46ab73f3511a5353d4e30af6d4">More...</a><br /></td></tr>
<tr class="separator:a42856d46ab73f3511a5353d4e30af6d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebadff6988380fa81412e6c0dc0f6add"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#aebadff6988380fa81412e6c0dc0f6add">ssl_load_certificates</a> (SSL_CTX *ctx)</td></tr>
<tr class="memdesc:aebadff6988380fa81412e6c0dc0f6add"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load certificates and filter out the expired ones.  <a href="#aebadff6988380fa81412e6c0dc0f6add">More...</a><br /></td></tr>
<tr class="separator:aebadff6988380fa81412e6c0dc0f6add"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add4f4eabd8404f14dd429fb02476f6ff"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#add4f4eabd8404f14dd429fb02476f6ff">ssl_set_verify_partial</a> (SSL_CTX *ctx)</td></tr>
<tr class="memdesc:add4f4eabd8404f14dd429fb02476f6ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allow verification using partial chains (with no root)  <a href="#add4f4eabd8404f14dd429fb02476f6ff">More...</a><br /></td></tr>
<tr class="separator:add4f4eabd8404f14dd429fb02476f6ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13c099b66aaf5ef1eba6df644a9cd82d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a> (const char *file)</td></tr>
<tr class="memdesc:a13c099b66aaf5ef1eba6df644a9cd82d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a source of random numbers.  <a href="#a13c099b66aaf5ef1eba6df644a9cd82d">More...</a><br /></td></tr>
<tr class="separator:a13c099b66aaf5ef1eba6df644a9cd82d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0eb5f86037e1612ca14cd3a0a87a0dc"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#ad0eb5f86037e1612ca14cd3a0a87a0dc">ssl_err</a> (struct SslSockData *data, int err)</td></tr>
<tr class="memdesc:ad0eb5f86037e1612ca14cd3a0a87a0dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Display an SSL error message.  <a href="#ad0eb5f86037e1612ca14cd3a0a87a0dc">More...</a><br /></td></tr>
<tr class="separator:ad0eb5f86037e1612ca14cd3a0a87a0dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f0e82431c3c3b2f63982217cc0e9f50"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a8f0e82431c3c3b2f63982217cc0e9f50">ssl_dprint_err_stack</a> (void)</td></tr>
<tr class="memdesc:a8f0e82431c3c3b2f63982217cc0e9f50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dump the SSL error stack.  <a href="#a8f0e82431c3c3b2f63982217cc0e9f50">More...</a><br /></td></tr>
<tr class="separator:a8f0e82431c3c3b2f63982217cc0e9f50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68682ecd35358cb52878d8bcf0724e93"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a68682ecd35358cb52878d8bcf0724e93">ssl_passwd_cb</a> (char *buf, int buflen, int rwflag, void *userdata)</td></tr>
<tr class="memdesc:a68682ecd35358cb52878d8bcf0724e93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to get a password.  <a href="#a68682ecd35358cb52878d8bcf0724e93">More...</a><br /></td></tr>
<tr class="separator:a68682ecd35358cb52878d8bcf0724e93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c36f9660a30f073893f32139a8bfa04"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a6c36f9660a30f073893f32139a8bfa04">ssl_socket_open_err</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:a6c36f9660a30f073893f32139a8bfa04"><td class="mdescLeft">&#160;</td><td class="mdescRight">Error callback for opening an SSL connection - Implements <a class="el" href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2" title="Note about ssf: in actuality, NeoMutt uses this as a boolean to determine if the connection is &quot;secur...">Connection::open()</a>  <a href="#a6c36f9660a30f073893f32139a8bfa04">More...</a><br /></td></tr>
<tr class="separator:a6c36f9660a30f073893f32139a8bfa04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ffadaf8220389dd2d422db1daaf46aa"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a6ffadaf8220389dd2d422db1daaf46aa">x509_get_part</a> (X509_NAME *name, int nid)</td></tr>
<tr class="memdesc:a6ffadaf8220389dd2d422db1daaf46aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve from X509 data.  <a href="#a6ffadaf8220389dd2d422db1daaf46aa">More...</a><br /></td></tr>
<tr class="separator:a6ffadaf8220389dd2d422db1daaf46aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add87edd5fed87dd2b4845b43f4a588d3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#add87edd5fed87dd2b4845b43f4a588d3">x509_fingerprint</a> (char *s, int l, X509 *cert, const EVP_MD *(*hashfunc)(void))</td></tr>
<tr class="memdesc:add87edd5fed87dd2b4845b43f4a588d3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate a fingerprint for an X509 certificate.  <a href="#add87edd5fed87dd2b4845b43f4a588d3">More...</a><br /></td></tr>
<tr class="separator:add87edd5fed87dd2b4845b43f4a588d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa654a0adad3010a4d0d68fae41742816"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#aa654a0adad3010a4d0d68fae41742816">asn1time_to_string</a> (ASN1_UTCTIME *tm)</td></tr>
<tr class="memdesc:aa654a0adad3010a4d0d68fae41742816"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a time to a string.  <a href="#aa654a0adad3010a4d0d68fae41742816">More...</a><br /></td></tr>
<tr class="separator:aa654a0adad3010a4d0d68fae41742816"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4beebc53c57442012424fe2dcfcada63"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a4beebc53c57442012424fe2dcfcada63">compare_certificates</a> (X509 *cert, X509 *peercert, unsigned char *peermd, unsigned int peermdlen)</td></tr>
<tr class="memdesc:a4beebc53c57442012424fe2dcfcada63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare two X509 certificated.  <a href="#a4beebc53c57442012424fe2dcfcada63">More...</a><br /></td></tr>
<tr class="separator:a4beebc53c57442012424fe2dcfcada63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad29824f6d037bbefe08d5551fafabe74"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a> (X509 *peercert, bool silent)</td></tr>
<tr class="memdesc:ad29824f6d037bbefe08d5551fafabe74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a certificate has expired.  <a href="#ad29824f6d037bbefe08d5551fafabe74">More...</a><br /></td></tr>
<tr class="separator:ad29824f6d037bbefe08d5551fafabe74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae39adc817bff49725d338570174c4a0b"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#ae39adc817bff49725d338570174c4a0b">hostname_match</a> (const char *hostname, const char *certname)</td></tr>
<tr class="memdesc:ae39adc817bff49725d338570174c4a0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does the hostname match the certificate.  <a href="#ae39adc817bff49725d338570174c4a0b">More...</a><br /></td></tr>
<tr class="separator:ae39adc817bff49725d338570174c4a0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2e20046425bd97175be33f596af1511"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#ac2e20046425bd97175be33f596af1511">ssl_init</a> (void)</td></tr>
<tr class="memdesc:ac2e20046425bd97175be33f596af1511"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the SSL library.  <a href="#ac2e20046425bd97175be33f596af1511">More...</a><br /></td></tr>
<tr class="separator:ac2e20046425bd97175be33f596af1511"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad249269819bbf126758110522b538d62"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#ad249269819bbf126758110522b538d62">ssl_get_client_cert</a> (struct SslSockData *ssldata, struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:ad249269819bbf126758110522b538d62"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the client certificate for an SSL connection.  <a href="#ad249269819bbf126758110522b538d62">More...</a><br /></td></tr>
<tr class="separator:ad249269819bbf126758110522b538d62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a580181fa12ad95a66805761f701e7cd2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a580181fa12ad95a66805761f701e7cd2">ssl_socket_close_and_restore</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:a580181fa12ad95a66805761f701e7cd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close an SSL <a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a> and restore <a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a> callbacks - Implements <a class="el" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc" title="Close a socket Connection. ">Connection::close()</a>  <a href="#a580181fa12ad95a66805761f701e7cd2">More...</a><br /></td></tr>
<tr class="separator:a580181fa12ad95a66805761f701e7cd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f1104e3e22a4015529223f2288398f3"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a5f1104e3e22a4015529223f2288398f3">check_certificate_cache</a> (X509 *peercert)</td></tr>
<tr class="memdesc:a5f1104e3e22a4015529223f2288398f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Is the X509 Certificate in the cache?  <a href="#a5f1104e3e22a4015529223f2288398f3">More...</a><br /></td></tr>
<tr class="separator:a5f1104e3e22a4015529223f2288398f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada3c8409337c74100a934208b0551be0"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#ada3c8409337c74100a934208b0551be0">check_certificate_file</a> (X509 *peercert)</td></tr>
<tr class="memdesc:ada3c8409337c74100a934208b0551be0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read and check a certificate file.  <a href="#ada3c8409337c74100a934208b0551be0">More...</a><br /></td></tr>
<tr class="separator:ada3c8409337c74100a934208b0551be0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a039081100802f18e9d2fb80b492e61ac"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a039081100802f18e9d2fb80b492e61ac">check_host</a> (X509 *x509cert, const char *hostname, char *err, size_t errlen)</td></tr>
<tr class="memdesc:a039081100802f18e9d2fb80b492e61ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the host on the certificate.  <a href="#a039081100802f18e9d2fb80b492e61ac">More...</a><br /></td></tr>
<tr class="separator:a039081100802f18e9d2fb80b492e61ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdbe2b83fcf6173cf72e7f729f230a72"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#afdbe2b83fcf6173cf72e7f729f230a72">check_certificate_by_digest</a> (X509 *peercert)</td></tr>
<tr class="memdesc:afdbe2b83fcf6173cf72e7f729f230a72"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate a certificate by its digest.  <a href="#afdbe2b83fcf6173cf72e7f729f230a72">More...</a><br /></td></tr>
<tr class="separator:afdbe2b83fcf6173cf72e7f729f230a72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8bbb9fa54bc203070165c84f273cb0f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#ab8bbb9fa54bc203070165c84f273cb0f">ssl_cache_trusted_cert</a> (X509 *c)</td></tr>
<tr class="memdesc:ab8bbb9fa54bc203070165c84f273cb0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cache a trusted certificate.  <a href="#ab8bbb9fa54bc203070165c84f273cb0f">More...</a><br /></td></tr>
<tr class="separator:ab8bbb9fa54bc203070165c84f273cb0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa441cecbfccdb3f5d2afd621a696d2b5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#aa441cecbfccdb3f5d2afd621a696d2b5">add_cert</a> (const char *title, X509 *cert, bool issuer, struct ListHead *list)</td></tr>
<tr class="memdesc:aa441cecbfccdb3f5d2afd621a696d2b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Look up certificate info and save it to a list.  <a href="#aa441cecbfccdb3f5d2afd621a696d2b5">More...</a><br /></td></tr>
<tr class="separator:aa441cecbfccdb3f5d2afd621a696d2b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0a15dc5df31b626a42f31bd6a5ea7f4"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#ae0a15dc5df31b626a42f31bd6a5ea7f4">interactive_check_cert</a> (X509 *cert, int <a class="el" href="mailbox_8c.html#a103fe1fcacccda7d9cdacde44721faef">idx</a>, size_t len, SSL *ssl, bool allow_always)</td></tr>
<tr class="memdesc:ae0a15dc5df31b626a42f31bd6a5ea7f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ask the user if a certificate is valid.  <a href="#ae0a15dc5df31b626a42f31bd6a5ea7f4">More...</a><br /></td></tr>
<tr class="separator:ae0a15dc5df31b626a42f31bd6a5ea7f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93e2f01418ccb7300b9864837c0a2719"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a93e2f01418ccb7300b9864837c0a2719">ssl_verify_callback</a> (int preverify_ok, X509_STORE_CTX *ctx)</td></tr>
<tr class="memdesc:a93e2f01418ccb7300b9864837c0a2719"><td class="mdescLeft">&#160;</td><td class="mdescRight">Certificate verification callback.  <a href="#a93e2f01418ccb7300b9864837c0a2719">More...</a><br /></td></tr>
<tr class="separator:a93e2f01418ccb7300b9864837c0a2719"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7480af2397359ace6c8741be1e680295"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a7480af2397359ace6c8741be1e680295">ssl_negotiate</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn, struct SslSockData *ssldata)</td></tr>
<tr class="memdesc:a7480af2397359ace6c8741be1e680295"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempt to negotiate SSL over the wire.  <a href="#a7480af2397359ace6c8741be1e680295">More...</a><br /></td></tr>
<tr class="separator:a7480af2397359ace6c8741be1e680295"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ec5a9ba19a2973ea48b0ea491ce08a1"><td class="memItemLeft" align="right" valign="top">static struct SslSockData *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:a3ec5a9ba19a2973ea48b0ea491ce08a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a <a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a>'s socket data.  <a href="#a3ec5a9ba19a2973ea48b0ea491ce08a1">More...</a><br /></td></tr>
<tr class="separator:a3ec5a9ba19a2973ea48b0ea491ce08a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dd67086d5ccb49018781662b104954e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a5dd67086d5ccb49018781662b104954e">ssl_setup</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:a5dd67086d5ccb49018781662b104954e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up SSL on the <a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a>.  <a href="#a5dd67086d5ccb49018781662b104954e">More...</a><br /></td></tr>
<tr class="separator:a5dd67086d5ccb49018781662b104954e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30f5a89c44c5daba9413290a83abdd9c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a30f5a89c44c5daba9413290a83abdd9c">ssl_socket_poll</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn, time_t wait_secs)</td></tr>
<tr class="memdesc:a30f5a89c44c5daba9413290a83abdd9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether a socket read would block - Implements <a class="el" href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f" title="Check whether a socket read would block. ">Connection::poll()</a>  <a href="#a30f5a89c44c5daba9413290a83abdd9c">More...</a><br /></td></tr>
<tr class="separator:a30f5a89c44c5daba9413290a83abdd9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee6856c134462c191da6659c8b469145"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#aee6856c134462c191da6659c8b469145">ssl_socket_open</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:aee6856c134462c191da6659c8b469145"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open an SSL socket - Implements <a class="el" href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2" title="Note about ssf: in actuality, NeoMutt uses this as a boolean to determine if the connection is &quot;secur...">Connection::open()</a>  <a href="#aee6856c134462c191da6659c8b469145">More...</a><br /></td></tr>
<tr class="separator:aee6856c134462c191da6659c8b469145"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61b00cd8dc0e66e258ab0d7d9286113e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a61b00cd8dc0e66e258ab0d7d9286113e">ssl_socket_read</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn, char *buf, size_t count)</td></tr>
<tr class="memdesc:a61b00cd8dc0e66e258ab0d7d9286113e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read data from an SSL socket - Implements <a class="el" href="structConnection.html#afdd852b383b3926639ec9132c048590a" title="Read from a socket Connection. ">Connection::read()</a>  <a href="#a61b00cd8dc0e66e258ab0d7d9286113e">More...</a><br /></td></tr>
<tr class="separator:a61b00cd8dc0e66e258ab0d7d9286113e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40b2b0f0a706d96487919a4b0489026a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a40b2b0f0a706d96487919a4b0489026a">ssl_socket_write</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn, const char *buf, size_t count)</td></tr>
<tr class="memdesc:a40b2b0f0a706d96487919a4b0489026a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write data to an SSL socket - Implements <a class="el" href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db" title="Write to a socket Connection. ">Connection::write()</a>  <a href="#a40b2b0f0a706d96487919a4b0489026a">More...</a><br /></td></tr>
<tr class="separator:a40b2b0f0a706d96487919a4b0489026a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafcc34fa7bf9d54a9323c36761353e6a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#aafcc34fa7bf9d54a9323c36761353e6a">ssl_socket_close</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:aafcc34fa7bf9d54a9323c36761353e6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close an SSL connection - Implements <a class="el" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc" title="Close a socket Connection. ">Connection::close()</a>  <a href="#aafcc34fa7bf9d54a9323c36761353e6a">More...</a><br /></td></tr>
<tr class="separator:aafcc34fa7bf9d54a9323c36761353e6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23591e82bf992ceb5e62c459fd787b8a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#a23591e82bf992ceb5e62c459fd787b8a">mutt_ssl_starttls</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:a23591e82bf992ceb5e62c459fd787b8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Negotiate TLS over an already opened connection.  <a href="#a23591e82bf992ceb5e62c459fd787b8a">More...</a><br /></td></tr>
<tr class="separator:a23591e82bf992ceb5e62c459fd787b8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6341b74ebed0751e68285e6bf379fab"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#ae6341b74ebed0751e68285e6bf379fab">mutt_ssl_socket_setup</a> (struct <a class="el" href="structConnection.html">Connection</a> *conn)</td></tr>
<tr class="memdesc:ae6341b74ebed0751e68285e6bf379fab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up SSL socket mulitplexor.  <a href="#ae6341b74ebed0751e68285e6bf379fab">More...</a><br /></td></tr>
<tr class="separator:ae6341b74ebed0751e68285e6bf379fab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab43c12dc4d5c8504c852b18a43ef0f8a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a> = -1</td></tr>
<tr class="separator:ab43c12dc4d5c8504c852b18a43ef0f8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af84a999f737b3cc63228cecc117a5d87"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a> = -1</td></tr>
<tr class="separator:af84a999f737b3cc63228cecc117a5d87"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Handling of OpenSSL encryption. </p>
<dl class="section author"><dt>Authors</dt><dd><ul>
<li>Tommi Komulainen</li>
</ul>
</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 2 of the License, or (at your option) any later version.</dd></dl>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. </p>

<p class="definition">Definition in file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a42856d46ab73f3511a5353d4e30af6d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42856d46ab73f3511a5353d4e30af6d4">&#9670;&nbsp;</a></span>STACK_OF()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static STACK_OF </td>
          <td>(</td>
          <td class="paramtype">X509&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>SSL socket data -. </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00090">90</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;{</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  SSL_CTX *sctx;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  SSL *ssl;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> isopen;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;};</div></div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a42856d46ab73f3511a5353d4e30af6d4_icgraph.svg" width="242" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aebadff6988380fa81412e6c0dc0f6add"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebadff6988380fa81412e6c0dc0f6add">&#9670;&nbsp;</a></span>ssl_load_certificates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_load_certificates </td>
          <td>(</td>
          <td class="paramtype">SSL_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Load certificates and filter out the expired ones. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>SSL context </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>Success </td></tr>
    <tr><td class="paramname">0</td><td>Error</td></tr>
  </table>
  </dd>
</dl>
<p>ssl certificate verification can behave strangely if there are expired certs loaded into the trusted store. This function filters out expired certs.</p>
<p>Previously the code used this form: SSL_CTX_load_verify_locations (ssldata-&gt;ctx, <code>$certificate_file</code>, NULL); </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00116">116</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;{</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordtype">int</span> rc = 1;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;loading trusted certificates\n&quot;</span>);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  X509_STORE *store = SSL_CTX_get_cert_store(ctx);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordflow">if</span> (!store)</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    store = X509_STORE_new();</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    SSL_CTX_set_cert_store(ctx, store);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_certificate_file =</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <a class="code" href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;certificate_file&quot;</span>);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  FILE *fp = <a class="code" href="file_8c.html#ae1c0c19fec03274220b3ca065ad1e2e5">mutt_file_fopen</a>(c_certificate_file, <span class="stringliteral">&quot;rt&quot;</span>);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">if</span> (!fp)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  X509 *cert = NULL;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordflow">while</span> (NULL != PEM_read_X509(fp, &amp;cert, NULL, NULL))</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> ((X509_cmp_current_time(X509_get0_notBefore(cert)) &gt;= 0) ||</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        (X509_cmp_current_time(X509_get0_notAfter(cert)) &lt;= 0))</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="keywordtype">char</span> buf[256];</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;filtering expired cert: %s\n&quot;</span>,</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                 X509_NAME_oneline(X509_get_subject_name(cert), buf, <span class="keyword">sizeof</span>(buf)));</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      X509_STORE_add_cert(store, cert);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="comment">/* PEM_read_X509 sets the error NO_START_LINE on eof */</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">if</span> (ERR_GET_REASON(ERR_peek_last_error()) != PEM_R_NO_START_LINE)</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    rc = 0;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  ERR_clear_error();</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  X509_free(cert);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <a class="code" href="file_8c.html#a31f49795ff5b9558db5476e5777e63b6">mutt_file_fclose</a>(&amp;fp);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div><div class="ttc" id="structNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00036">neomutt.h:36</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a></div><div class="ttdoc">Log at debug level 2. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00041">logging.h:41</a></div></div>
<div class="ttc" id="file_8c_html_a31f49795ff5b9558db5476e5777e63b6"><div class="ttname"><a href="file_8c.html#a31f49795ff5b9558db5476e5777e63b6">mutt_file_fclose</a></div><div class="ttdeci">int mutt_file_fclose(FILE **fp)</div><div class="ttdoc">Close a FILE handle (and NULL the pointer) </div><div class="ttdef"><b>Definition:</b> <a href="file_8c_source.html#l00153">file.c:153</a></div></div>
<div class="ttc" id="helpers_8c_html_acadf9e29fd733422508496a70a080c09"><div class="ttname"><a href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00194">helpers.c:194</a></div></div>
<div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="structNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00039">neomutt.h:39</a></div></div>
<div class="ttc" id="file_8c_html_ae1c0c19fec03274220b3ca065ad1e2e5"><div class="ttname"><a href="file_8c.html#ae1c0c19fec03274220b3ca065ad1e2e5">mutt_file_fopen</a></div><div class="ttdeci">FILE * mutt_file_fopen(const char *path, const char *mode)</div><div class="ttdoc">Call fopen() safely. </div><div class="ttdef"><b>Definition:</b> <a href="file_8c_source.html#l00589">file.c:589</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aebadff6988380fa81412e6c0dc0f6add_cgraph.svg" width="340" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aebadff6988380fa81412e6c0dc0f6add_icgraph.svg" width="296" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="add4f4eabd8404f14dd429fb02476f6ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add4f4eabd8404f14dd429fb02476f6ff">&#9670;&nbsp;</a></span>ssl_set_verify_partial()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_set_verify_partial </td>
          <td>(</td>
          <td class="paramtype">SSL_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allow verification using partial chains (with no root) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>SSL context </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00166">166</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;{</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordtype">int</span> rc = 0;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">#ifdef HAVE_SSL_PARTIAL_CHAIN</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  X509_VERIFY_PARAM *param = NULL;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_verify_partial_chains =</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_verify_partial_chains&quot;</span>);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordflow">if</span> (c_ssl_verify_partial_chains)</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    param = X509_VERIFY_PARAM_new();</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (param)</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      X509_VERIFY_PARAM_set_flags(param, X509_V_FLAG_PARTIAL_CHAIN);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">if</span> (SSL_CTX_set1_param(ctx, param) == 0)</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;SSL_CTX_set1_param() failed\n&quot;</span>);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        rc = -1;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      X509_VERIFY_PARAM_free(param);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;X509_VERIFY_PARAM_new() failed\n&quot;</span>);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      rc = -1;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div><div class="ttc" id="helpers_8c_html_ae50f679dd6c5bd1ba820884c8602f038"><div class="ttname"><a href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a></div><div class="ttdeci">bool cs_subset_bool(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a boolean config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00073">helpers.c:73</a></div></div>
<div class="ttc" id="structNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00036">neomutt.h:36</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a></div><div class="ttdoc">Log at debug level 2. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00041">logging.h:41</a></div></div>
<div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="structNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00039">neomutt.h:39</a></div></div>
</div><!-- fragment --><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_add4f4eabd8404f14dd429fb02476f6ff_cgraph.svg" width="342" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_add4f4eabd8404f14dd429fb02476f6ff_icgraph.svg" width="303" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a13c099b66aaf5ef1eba6df644a9cd82d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13c099b66aaf5ef1eba6df644a9cd82d">&#9670;&nbsp;</a></span>add_entropy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int add_entropy </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Add a source of random numbers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>Random device </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">&gt;0</td><td>Success, number of bytes read from the source </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00203">203</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;{</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">if</span> (!file)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">int</span> n = -1;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordflow">if</span> (stat(file, &amp;st) == -1)</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">return</span> (errno == ENOENT) ? 0 : -1;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Filling entropy pool: %s...&quot;</span>), file);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">/* check that the file permissions are secure */</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordflow">if</span> ((st.st_uid != getuid()) || ((st.st_mode &amp; (S_IWGRP | S_IRGRP)) != 0) ||</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      ((st.st_mode &amp; (S_IWOTH | S_IROTH)) != 0))</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;%s has insecure permissions&quot;</span>), file);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">#ifdef HAVE_RAND_EGD</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  n = RAND_egd(file);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">if</span> (n &lt;= 0)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    n = RAND_load_file(file, -1);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordflow">return</span> n;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div><div class="ttc" id="group__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00088">logging.h:88</a></div></div>
<div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="group__logging__api_html_gae108f891125caafa9250cf0959c40c04"><div class="ttname"><a href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a></div><div class="ttdeci">#define mutt_message(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00087">logging.h:87</a></div></div>
</div><!-- fragment --><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a13c099b66aaf5ef1eba6df644a9cd82d_icgraph.svg" width="230" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad0eb5f86037e1612ca14cd3a0a87a0dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0eb5f86037e1612ca14cd3a0a87a0dc">&#9670;&nbsp;</a></span>ssl_err()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ssl_err </td>
          <td>(</td>
          <td class="paramtype">struct SslSockData *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Display an SSL error message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>SSL socket data </td></tr>
    <tr><td class="paramname">err</td><td>SSL error code </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00238">238</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;{</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordtype">int</span> e = SSL_get_error(data-&gt;ssl, err);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">switch</span> (e)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_NONE:</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_ZERO_RETURN:</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      data-&gt;isopen = 0;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_SYSCALL:</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      data-&gt;isopen = 0;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *errmsg = NULL;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sslerr;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">switch</span> (e)</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_SYSCALL:</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      errmsg = <span class="stringliteral">&quot;I/O error&quot;</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_WANT_ACCEPT:</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      errmsg = <span class="stringliteral">&quot;retry accept&quot;</span>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_WANT_CONNECT:</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      errmsg = <span class="stringliteral">&quot;retry connect&quot;</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_WANT_READ:</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      errmsg = <span class="stringliteral">&quot;retry read&quot;</span>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_WANT_WRITE:</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      errmsg = <span class="stringliteral">&quot;retry write&quot;</span>;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_WANT_X509_LOOKUP:</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      errmsg = <span class="stringliteral">&quot;retry x509 lookup&quot;</span>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_ZERO_RETURN:</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      errmsg = <span class="stringliteral">&quot;SSL connection closed&quot;</span>;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">case</span> SSL_ERROR_SSL:</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      sslerr = ERR_get_error();</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">switch</span> (sslerr)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          <span class="keywordflow">switch</span> (err)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;          {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;              errmsg = <span class="stringliteral">&quot;EOF&quot;</span>;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;              errmsg = strerror(errno);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          errmsg = ERR_error_string(sslerr, NULL);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      errmsg = <span class="stringliteral">&quot;unknown error&quot;</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;SSL error: %s\n&quot;</span>, errmsg);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;}</div><div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a></div><div class="ttdoc">Log at debug level 1. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00040">logging.h:40</a></div></div>
</div><!-- fragment --><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ad0eb5f86037e1612ca14cd3a0a87a0dc_icgraph.svg" width="255" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a8f0e82431c3c3b2f63982217cc0e9f50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f0e82431c3c3b2f63982217cc0e9f50">&#9670;&nbsp;</a></span>ssl_dprint_err_stack()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ssl_dprint_err_stack </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Dump the SSL error stack. </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00307">307</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;{</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  BIO *bio = BIO_new(BIO_s_mem());</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordflow">if</span> (!bio)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  ERR_print_errors(bio);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordtype">char</span> *buf = NULL;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordtype">long</span> buflen = BIO_get_mem_data(bio, &amp;buf);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">if</span> (buflen &gt; 0)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordtype">char</span> *output = <a class="code" href="memory_8c.html#a264da4dc58e6dc8983285bd1f538f24d">mutt_mem_malloc</a>(buflen + 1);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    memcpy(output, buf, buflen);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    output[buflen] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;SSL error stack: %s\n&quot;</span>, output);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;output);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  BIO_free(bio);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div><div class="ttc" id="memory_8c_html_a264da4dc58e6dc8983285bd1f538f24d"><div class="ttname"><a href="memory_8c.html#a264da4dc58e6dc8983285bd1f538f24d">mutt_mem_malloc</a></div><div class="ttdeci">void * mutt_mem_malloc(size_t size)</div><div class="ttdoc">Allocate memory on the heap. </div><div class="ttdef"><b>Definition:</b> <a href="memory_8c_source.html#l00090">memory.c:90</a></div></div>
<div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a></div><div class="ttdoc">Log at debug level 1. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00040">logging.h:40</a></div></div>
<div class="ttc" id="memory_8h_html_a25875003b43b81a4302256caa4a13599"><div class="ttname"><a href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a></div><div class="ttdeci">#define FREE(x)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00040">memory.h:40</a></div></div>
</div><!-- fragment --><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a8f0e82431c3c3b2f63982217cc0e9f50_cgraph.svg" width="356" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a8f0e82431c3c3b2f63982217cc0e9f50_icgraph.svg" width="294" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a68682ecd35358cb52878d8bcf0724e93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68682ecd35358cb52878d8bcf0724e93">&#9670;&nbsp;</a></span>ssl_passwd_cb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_passwd_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>buflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rwflag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>userdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback to get a password. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td><a class="el" href="structBuffer.html" title="String manipulation buffer. ">Buffer</a> for the password </td></tr>
    <tr><td class="paramname">buflen</td><td>Length of the buffer </td></tr>
    <tr><td class="paramname">rwflag</td><td>0 if writing, 1 if reading (UNUSED) </td></tr>
    <tr><td class="paramname">userdata</td><td><a class="el" href="structConnAccount.html" title="Login details for a remote server. ">ConnAccount</a> whose password is requested </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">&gt;0</td><td>Success, number of chars written to buf </td></tr>
    <tr><td class="paramname">0</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00336">336</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;{</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keyword">struct </span><a class="code" href="structConnAccount.html">ConnAccount</a> *cac = userdata;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="connaccount_8c.html#a2e00de19727c4db19f452dde494a770a">mutt_account_getuser</a>(cac) &lt; 0)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;getting password for %s@%s:%u\n&quot;</span>, cac-&gt;<a class="code" href="structConnAccount.html#a48b8084b2dd1ef3d4e051a01cf15c7ca">user</a>, cac-&gt;<a class="code" href="structConnAccount.html#aa440323ef3111e1faaf33f6a57103a3a">host</a>, cac-&gt;<a class="code" href="structConnAccount.html#aff0fc77d9a388c80c347c5c2c925086d">port</a>);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="connaccount_8c.html#a2bc0b90ace43b835b6ad51f3d8fa5c1a">mutt_account_getpass</a>(cac) &lt; 0)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">return</span> snprintf(buf, buflen, <span class="stringliteral">&quot;%s&quot;</span>, cac-&gt;<a class="code" href="structConnAccount.html#a842f1bf5afe0830ae96d80bdacead037">pass</a>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;}</div><div class="ttc" id="connaccount_8c_html_a2e00de19727c4db19f452dde494a770a"><div class="ttname"><a href="connaccount_8c.html#a2e00de19727c4db19f452dde494a770a">mutt_account_getuser</a></div><div class="ttdeci">int mutt_account_getuser(struct ConnAccount *cac)</div><div class="ttdoc">Retrieve username into ConnAccount, if necessary. </div><div class="ttdef"><b>Definition:</b> <a href="connaccount_8c_source.html#l00047">connaccount.c:47</a></div></div>
<div class="ttc" id="structConnAccount_html_a48b8084b2dd1ef3d4e051a01cf15c7ca"><div class="ttname"><a href="structConnAccount.html#a48b8084b2dd1ef3d4e051a01cf15c7ca">ConnAccount::user</a></div><div class="ttdeci">char user[128]</div><div class="ttdoc">Username. </div><div class="ttdef"><b>Definition:</b> <a href="connaccount_8h_source.html#l00055">connaccount.h:55</a></div></div>
<div class="ttc" id="structConnAccount_html_aa440323ef3111e1faaf33f6a57103a3a"><div class="ttname"><a href="structConnAccount.html#aa440323ef3111e1faaf33f6a57103a3a">ConnAccount::host</a></div><div class="ttdeci">char host[128]</div><div class="ttdoc">Server to login to. </div><div class="ttdef"><b>Definition:</b> <a href="connaccount_8h_source.html#l00053">connaccount.h:53</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a></div><div class="ttdoc">Log at debug level 2. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00041">logging.h:41</a></div></div>
<div class="ttc" id="structConnAccount_html_a842f1bf5afe0830ae96d80bdacead037"><div class="ttname"><a href="structConnAccount.html#a842f1bf5afe0830ae96d80bdacead037">ConnAccount::pass</a></div><div class="ttdeci">char pass[256]</div><div class="ttdoc">Password. </div><div class="ttdef"><b>Definition:</b> <a href="connaccount_8h_source.html#l00056">connaccount.h:56</a></div></div>
<div class="ttc" id="structConnAccount_html_aff0fc77d9a388c80c347c5c2c925086d"><div class="ttname"><a href="structConnAccount.html#aff0fc77d9a388c80c347c5c2c925086d">ConnAccount::port</a></div><div class="ttdeci">unsigned short port</div><div class="ttdoc">Port to connect to. </div><div class="ttdef"><b>Definition:</b> <a href="connaccount_8h_source.html#l00057">connaccount.h:57</a></div></div>
<div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="structConnAccount_html"><div class="ttname"><a href="structConnAccount.html">ConnAccount</a></div><div class="ttdoc">Login details for a remote server. </div><div class="ttdef"><b>Definition:</b> <a href="connaccount_8h_source.html#l00051">connaccount.h:51</a></div></div>
<div class="ttc" id="connaccount_8c_html_a2bc0b90ace43b835b6ad51f3d8fa5c1a"><div class="ttname"><a href="connaccount_8c.html#a2bc0b90ace43b835b6ad51f3d8fa5c1a">mutt_account_getpass</a></div><div class="ttdeci">int mutt_account_getpass(struct ConnAccount *cac)</div><div class="ttdoc">Fetch password into ConnAccount, if necessary. </div><div class="ttdef"><b>Definition:</b> <a href="connaccount_8c_source.html#l00110">connaccount.c:110</a></div></div>
</div><!-- fragment --><div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a68682ecd35358cb52878d8bcf0724e93_cgraph.svg" width="347" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a68682ecd35358cb52878d8bcf0724e93_icgraph.svg" width="320" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6c36f9660a30f073893f32139a8bfa04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c36f9660a30f073893f32139a8bfa04">&#9670;&nbsp;</a></span>ssl_socket_open_err()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_socket_open_err </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Error callback for opening an SSL connection - Implements <a class="el" href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2" title="Note about ssf: in actuality, NeoMutt uses this as a boolean to determine if the connection is &quot;secur...">Connection::open()</a> </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Always </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00355">355</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;{</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SSL disabled due to the lack of entropy&quot;</span>));</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;}</div><div class="ttc" id="group__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00088">logging.h:88</a></div></div>
<div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
</div><!-- fragment --><div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a6c36f9660a30f073893f32139a8bfa04_icgraph.svg" width="384" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6ffadaf8220389dd2d422db1daaf46aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ffadaf8220389dd2d422db1daaf46aa">&#9670;&nbsp;</a></span>x509_get_part()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char* x509_get_part </td>
          <td>(</td>
          <td class="paramtype">X509_NAME *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve from X509 data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Name of data to retrieve </td></tr>
    <tr><td class="paramname">nid</td><td>ID of the item to retrieve </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Retrieved data</td></tr>
  </table>
  </dd>
</dl>
<p>The returned pointer is to a static buffer, so it must not be free()'d. </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00369">369</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;{</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> data[128];</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (!name || (X509_NAME_get_text_by_NID(name, nid, data, <span class="keyword">sizeof</span>(data)) &lt; 0))</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordflow">return</span> data;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;}</div></div><!-- fragment --><div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a6ffadaf8220389dd2d422db1daaf46aa_icgraph.svg" width="252" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="add87edd5fed87dd2b4845b43f4a588d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add87edd5fed87dd2b4845b43f4a588d3">&#9670;&nbsp;</a></span>x509_fingerprint()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void x509_fingerprint </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const EVP_MD *(*)(void)&#160;</td>
          <td class="paramname"><em>hashfunc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate a fingerprint for an X509 certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td><a class="el" href="structBuffer.html" title="String manipulation buffer. ">Buffer</a> for fingerprint </td></tr>
    <tr><td class="paramname">l</td><td>Length of buffer </td></tr>
    <tr><td class="paramname">cert</td><td>Certificate </td></tr>
    <tr><td class="paramname">hashfunc</td><td>Hashing function </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00386">386</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;{</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> md[EVP_MAX_MD_SIZE];</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">if</span> (X509_digest(cert, hashfunc(), md, &amp;n) == 0) <span class="comment">// Failure</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    snprintf(s, l, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[unable to calculate]&quot;</span>));</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; n; i++)</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordtype">char</span> ch[8];</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      snprintf(ch, <span class="keyword">sizeof</span>(ch), <span class="stringliteral">&quot;%02X%s&quot;</span>, md[i], ((i % 2) ? <span class="stringliteral">&quot; &quot;</span> : <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <a class="code" href="mutt_2string_8c.html#ae6900b5833f68692e265c5732b2a3556">mutt_str_cat</a>(s, l, ch);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;}</div><div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="mutt_2string_8c_html_ae6900b5833f68692e265c5732b2a3556"><div class="ttname"><a href="mutt_2string_8c.html#ae6900b5833f68692e265c5732b2a3556">mutt_str_cat</a></div><div class="ttdeci">char * mutt_str_cat(char *buf, size_t buflen, const char *s)</div><div class="ttdoc">Concatenate two strings. </div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00385">string.c:385</a></div></div>
</div><!-- fragment --><div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_add87edd5fed87dd2b4845b43f4a588d3_cgraph.svg" width="291" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_add87edd5fed87dd2b4845b43f4a588d3_icgraph.svg" width="356" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa654a0adad3010a4d0d68fae41742816"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa654a0adad3010a4d0d68fae41742816">&#9670;&nbsp;</a></span>asn1time_to_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char* asn1time_to_string </td>
          <td>(</td>
          <td class="paramtype">ASN1_UTCTIME *&#160;</td>
          <td class="paramname"><em>tm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Convert a time to a string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tm</td><td>Time to convert </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Time string</td></tr>
  </table>
  </dd>
</dl>
<p>The returned pointer is to a static buffer, so it must not be free()'d. </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00413">413</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;{</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> buf[64];</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  BIO *bio = NULL;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <a class="code" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(buf, <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;[invalid date]&quot;</span>), <span class="keyword">sizeof</span>(buf));</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  bio = BIO_new(BIO_s_mem());</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordflow">if</span> (bio)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span> (ASN1_TIME_print(bio, tm))</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      (void) BIO_read(bio, buf, <span class="keyword">sizeof</span>(buf));</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    BIO_free(bio);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  }</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordflow">return</span> buf;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;}</div><div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="mutt_2string_8c_html_ad20e00309de897a1e882fc7400335b83"><div class="ttname"><a href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a></div><div class="ttdeci">size_t mutt_str_copy(char *dest, const char *src, size_t dsize)</div><div class="ttdoc">Copy a string into a buffer (guaranteeing NUL-termination) </div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00749">string.c:749</a></div></div>
</div><!-- fragment --><div id="dynsection-16" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aa654a0adad3010a4d0d68fae41742816_cgraph.svg" width="320" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-17" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aa654a0adad3010a4d0d68fae41742816_icgraph.svg" width="375" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a4beebc53c57442012424fe2dcfcada63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4beebc53c57442012424fe2dcfcada63">&#9670;&nbsp;</a></span>compare_certificates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool compare_certificates </td>
          <td>(</td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>peercert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>peermd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>peermdlen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compare two X509 certificated. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cert</td><td>Certificate </td></tr>
    <tr><td class="paramname">peercert</td><td>Peer certificate </td></tr>
    <tr><td class="paramname">peermd</td><td>Peer certificate message digest </td></tr>
    <tr><td class="paramname">peermdlen</td><td>Length of peer certificate message digest </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificates match </td></tr>
    <tr><td class="paramname">false</td><td>Certificates differ </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00440">440</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;{</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> md[EVP_MAX_MD_SIZE];</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mdlen;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="comment">/* Avoid CPU-intensive digest calculation if the certificates are</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">   * not even remotely equal.  */</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordflow">if</span> ((X509_subject_name_cmp(cert, peercert) != 0) ||</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      (X509_issuer_name_cmp(cert, peercert) != 0))</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  {</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordflow">if</span> (!X509_digest(cert, EVP_sha256(), md, &amp;mdlen) || (peermdlen != mdlen))</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordflow">if</span> (memcmp(peermd, md, mdlen) != 0)</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;}</div></div><!-- fragment --><div id="dynsection-18" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a4beebc53c57442012424fe2dcfcada63_icgraph.svg" width="590" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad29824f6d037bbefe08d5551fafabe74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad29824f6d037bbefe08d5551fafabe74">&#9670;&nbsp;</a></span>check_certificate_expiration()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_certificate_expiration </td>
          <td>(</td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>peercert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>silent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if a certificate has expired. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peercert</td><td>Certificate to check </td></tr>
    <tr><td class="paramname">silent</td><td>If true, don't notify the user if the certificate has expired </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificate is valid </td></tr>
    <tr><td class="paramname">false</td><td>Certificate has expired (or hasn't yet become valid) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00470">470</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;{</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_verify_dates =</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_verify_dates&quot;</span>);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">if</span> (c_ssl_verify_dates == <a class="code" href="quad_8h.html#a738f558a271fe5035e0ee3b700ee35dbabe3800cc419f25384aaf1892fc3c812b">MUTT_NO</a>)</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">if</span> (X509_cmp_current_time(X509_get0_notBefore(peercert)) &gt;= 0)</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">if</span> (!silent)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;Server certificate is not yet valid\n&quot;</span>);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Server certificate is not yet valid&quot;</span>));</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    }</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">if</span> (X509_cmp_current_time(X509_get0_notAfter(peercert)) &lt;= 0)</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span> (!silent)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;Server certificate has expired\n&quot;</span>);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Server certificate has expired&quot;</span>));</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  }</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div><div class="ttc" id="helpers_8c_html_ae50f679dd6c5bd1ba820884c8602f038"><div class="ttname"><a href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a></div><div class="ttdeci">bool cs_subset_bool(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a boolean config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00073">helpers.c:73</a></div></div>
<div class="ttc" id="group__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00088">logging.h:88</a></div></div>
<div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="structNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00036">neomutt.h:36</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a></div><div class="ttdoc">Log at debug level 2. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00041">logging.h:41</a></div></div>
<div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="quad_8h_html_a738f558a271fe5035e0ee3b700ee35dbabe3800cc419f25384aaf1892fc3c812b"><div class="ttname"><a href="quad_8h.html#a738f558a271fe5035e0ee3b700ee35dbabe3800cc419f25384aaf1892fc3c812b">MUTT_NO</a></div><div class="ttdoc">User answered &amp;#39;No&amp;#39;, or assume &amp;#39;No&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="quad_8h_source.html#l00038">quad.h:38</a></div></div>
<div class="ttc" id="structNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00039">neomutt.h:39</a></div></div>
</div><!-- fragment --><div id="dynsection-19" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ad29824f6d037bbefe08d5551fafabe74_cgraph.svg" width="386" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-20" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ad29824f6d037bbefe08d5551fafabe74_icgraph.svg" width="636" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ae39adc817bff49725d338570174c4a0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae39adc817bff49725d338570174c4a0b">&#9670;&nbsp;</a></span>hostname_match()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool hostname_match </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>hostname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>certname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Does the hostname match the certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hostname</td><td>Hostname </td></tr>
    <tr><td class="paramname">certname</td><td>Certificate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Hostname matches the certificate </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00506">506</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;{</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *cmp1 = NULL, *cmp2 = NULL;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="mutt_2string_8c.html#a6f574867aa9db4d434adbc8af1f5f7e7">mutt_strn_equal</a>(certname, <span class="stringliteral">&quot;*.&quot;</span>, 2))</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    cmp1 = certname + 2;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    cmp2 = strchr(hostname, <span class="charliteral">&#39;.&#39;</span>);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">if</span> (!cmp2)</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    cmp2++;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    cmp1 = certname;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    cmp2 = hostname;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">if</span> ((*cmp1 == <span class="charliteral">&#39;\0&#39;</span>) || (*cmp2 == <span class="charliteral">&#39;\0&#39;</span>))</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  }</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">if</span> (strcasecmp(cmp1, cmp2) != 0)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  {</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;}</div><div class="ttc" id="mutt_2string_8c_html_a6f574867aa9db4d434adbc8af1f5f7e7"><div class="ttname"><a href="mutt_2string_8c.html#a6f574867aa9db4d434adbc8af1f5f7e7">mutt_strn_equal</a></div><div class="ttdeci">bool mutt_strn_equal(const char *a, const char *b, size_t num)</div><div class="ttdoc">Check for equality of two strings (to a maximum), safely. </div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00593">string.c:593</a></div></div>
</div><!-- fragment --><div id="dynsection-21" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ae39adc817bff49725d338570174c4a0b_cgraph.svg" width="322" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-22" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ae39adc817bff49725d338570174c4a0b_icgraph.svg" width="288" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ac2e20046425bd97175be33f596af1511"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2e20046425bd97175be33f596af1511">&#9670;&nbsp;</a></span>ssl_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialise the SSL library. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error</td></tr>
  </table>
  </dd>
</dl>
<p>OpenSSL library needs to be fed with sufficient entropy. On systems with /dev/urandom, this is done transparently by the library itself, on other systems we need to fill the entropy pool ourselves.</p>
<p>Even though only OpenSSL 0.9.5 and later will complain about the lack of entropy, we try to our best and fill the pool with older versions also. (That's the reason for the ugly ifdefs and macros, otherwise I could have simply ifdef'd the whole ssl_init function) </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00552">552</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;{</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> init_complete = <span class="keyword">false</span>;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keywordflow">if</span> (init_complete)</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordflow">if</span> (RAND_status() != 1)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">/* load entropy from files */</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keyword">struct </span><a class="code" href="structBuffer.html">Buffer</a> *path = <a class="code" href="pool_8c.html#a2129d5ea0085753afdd37cf62161845d">mutt_buffer_pool_get</a>();</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_entropy_file =</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <a class="code" href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;entropy_file&quot;</span>);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <a class="code" href="openssl_8c.html#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a>(c_entropy_file);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="openssl_8c.html#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a>(RAND_file_name(path-&gt;<a class="code" href="structBuffer.html#aeec1fd4af0ddf6765b0187466d4361b8">data</a>, path-&gt;<a class="code" href="structBuffer.html#a1d9ee60bcf94de702b15ec2b5d811995">dsize</a>));</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">/* load entropy from egd sockets */</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="preprocessor">#ifdef HAVE_RAND_EGD</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <a class="code" href="openssl_8c.html#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a>(<a class="code" href="mutt_2string_8c.html#ad000586e39822e85693adda33c02e485">mutt_str_getenv</a>(<span class="stringliteral">&quot;EGDSOCKET&quot;</span>));</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <a class="code" href="buffer_8c.html#ad057ee239ae5bcfd72cab3749036ab02">mutt_buffer_printf</a>(path, <span class="stringliteral">&quot;%s/.entropy&quot;</span>, <a class="code" href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a>(<a class="code" href="config_2path_8c.html#a6f7b1cf93328b961c3e3a64f300d75b0">HomeDir</a>));</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="openssl_8c.html#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a>(<a class="code" href="buffer_8h.html#a4aca040fb75bc1dfc086cbfbf14ac8cd">mutt_buffer_string</a>(path));</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="openssl_8c.html#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a>(TMPDIR <span class="stringliteral">&quot;/entropy&quot;</span>);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">/* shuffle $RANDFILE (or ~/.rnd if unset) */</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    RAND_write_file(RAND_file_name(path-&gt;<a class="code" href="structBuffer.html#aeec1fd4af0ddf6765b0187466d4361b8">data</a>, path-&gt;<a class="code" href="structBuffer.html#a1d9ee60bcf94de702b15ec2b5d811995">dsize</a>));</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <a class="code" href="pool_8c.html#a08b48e2ac8849341888ee7429cc5093c">mutt_buffer_pool_release</a>(&amp;path);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <a class="code" href="mutt__logging_8c.html#af068b3f524a31fad293b2fb61dfc4534">mutt_clear_error</a>();</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> (RAND_status() != 1)</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Failed to find enough entropy on your system&quot;</span>));</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">/* OpenSSL performs automatic initialization as of 1.1.</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment"> * However LibreSSL does not (as of 2.8.3). */</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="preprocessor">#if (defined(OPENSSL_VERSION_NUMBER) &amp;&amp; (OPENSSL_VERSION_NUMBER &lt; 0x10100000L)) || \</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="preprocessor">    (defined(LIBRESSL_VERSION_NUMBER))</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="comment">/* I don&#39;t think you can do this just before reading the error. The call</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">   * itself might clobber the last SSL error. */</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  SSL_load_error_strings();</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  SSL_library_init();</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  init_complete = <span class="keyword">true</span>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;}</div><div class="ttc" id="string2_8h_html_a7e0481bed27661ea2679f256b24e0283"><div class="ttname"><a href="string2_8h.html#a7e0481bed27661ea2679f256b24e0283">NONULL</a></div><div class="ttdeci">#define NONULL(x)</div><div class="ttdef"><b>Definition:</b> <a href="string2_8h_source.html#l00037">string2.h:37</a></div></div>
<div class="ttc" id="pool_8c_html_a2129d5ea0085753afdd37cf62161845d"><div class="ttname"><a href="pool_8c.html#a2129d5ea0085753afdd37cf62161845d">mutt_buffer_pool_get</a></div><div class="ttdeci">struct Buffer * mutt_buffer_pool_get(void)</div><div class="ttdoc">Get a Buffer from the pool. </div><div class="ttdef"><b>Definition:</b> <a href="pool_8c_source.html#l00101">pool.c:101</a></div></div>
<div class="ttc" id="group__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00088">logging.h:88</a></div></div>
<div class="ttc" id="openssl_8c_html_a13c099b66aaf5ef1eba6df644a9cd82d"><div class="ttname"><a href="openssl_8c.html#a13c099b66aaf5ef1eba6df644a9cd82d">add_entropy</a></div><div class="ttdeci">static int add_entropy(const char *file)</div><div class="ttdoc">Add a source of random numbers. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00203">openssl.c:203</a></div></div>
<div class="ttc" id="pool_8c_html_a08b48e2ac8849341888ee7429cc5093c"><div class="ttname"><a href="pool_8c.html#a08b48e2ac8849341888ee7429cc5093c">mutt_buffer_pool_release</a></div><div class="ttdeci">void mutt_buffer_pool_release(struct Buffer **pbuf)</div><div class="ttdoc">Free a Buffer from the pool. </div><div class="ttdef"><b>Definition:</b> <a href="pool_8c_source.html#l00112">pool.c:112</a></div></div>
<div class="ttc" id="structBuffer_html"><div class="ttname"><a href="structBuffer.html">Buffer</a></div><div class="ttdoc">String manipulation buffer. </div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00033">buffer.h:33</a></div></div>
<div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="buffer_8c_html_ad057ee239ae5bcfd72cab3749036ab02"><div class="ttname"><a href="buffer_8c.html#ad057ee239ae5bcfd72cab3749036ab02">mutt_buffer_printf</a></div><div class="ttdeci">int mutt_buffer_printf(struct Buffer *buf, const char *fmt,...)</div><div class="ttdoc">Format a string overwriting a Buffer. </div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00160">buffer.c:160</a></div></div>
<div class="ttc" id="structNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00036">neomutt.h:36</a></div></div>
<div class="ttc" id="config_2path_8c_html_a6f7b1cf93328b961c3e3a64f300d75b0"><div class="ttname"><a href="config_2path_8c.html#a6f7b1cf93328b961c3e3a64f300d75b0">HomeDir</a></div><div class="ttdeci">char * HomeDir</div><div class="ttdoc">User&amp;#39;s home directory. </div><div class="ttdef"><b>Definition:</b> <a href="mutt__globals_8h_source.html#l00045">mutt_globals.h:45</a></div></div>
<div class="ttc" id="mutt_2string_8c_html_ad000586e39822e85693adda33c02e485"><div class="ttname"><a href="mutt_2string_8c.html#ad000586e39822e85693adda33c02e485">mutt_str_getenv</a></div><div class="ttdeci">const char * mutt_str_getenv(const char *name)</div><div class="ttdoc">Get an environment variable. </div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l01024">string.c:1024</a></div></div>
<div class="ttc" id="buffer_8h_html_a4aca040fb75bc1dfc086cbfbf14ac8cd"><div class="ttname"><a href="buffer_8h.html#a4aca040fb75bc1dfc086cbfbf14ac8cd">mutt_buffer_string</a></div><div class="ttdeci">static const char * mutt_buffer_string(const struct Buffer *buf)</div><div class="ttdoc">Convert a buffer to a const char * &quot;string&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00077">buffer.h:77</a></div></div>
<div class="ttc" id="structBuffer_html_a1d9ee60bcf94de702b15ec2b5d811995"><div class="ttname"><a href="structBuffer.html#a1d9ee60bcf94de702b15ec2b5d811995">Buffer::dsize</a></div><div class="ttdeci">size_t dsize</div><div class="ttdoc">Length of data. </div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00037">buffer.h:37</a></div></div>
<div class="ttc" id="mutt__logging_8c_html_af068b3f524a31fad293b2fb61dfc4534"><div class="ttname"><a href="mutt__logging_8c.html#af068b3f524a31fad293b2fb61dfc4534">mutt_clear_error</a></div><div class="ttdeci">void mutt_clear_error(void)</div><div class="ttdoc">Clear the message line (bottom line of screen) </div><div class="ttdef"><b>Definition:</b> <a href="mutt__logging_8c_source.html#l00112">mutt_logging.c:112</a></div></div>
<div class="ttc" id="structBuffer_html_aeec1fd4af0ddf6765b0187466d4361b8"><div class="ttname"><a href="structBuffer.html#aeec1fd4af0ddf6765b0187466d4361b8">Buffer::data</a></div><div class="ttdeci">char * data</div><div class="ttdoc">Pointer to data. </div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00035">buffer.h:35</a></div></div>
<div class="ttc" id="helpers_8c_html_acadf9e29fd733422508496a70a080c09"><div class="ttname"><a href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00194">helpers.c:194</a></div></div>
<div class="ttc" id="structNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00039">neomutt.h:39</a></div></div>
</div><!-- fragment --><div id="dynsection-23" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ac2e20046425bd97175be33f596af1511_cgraph.svg" width="315" height="392"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-24" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ac2e20046425bd97175be33f596af1511_icgraph.svg" width="298" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad249269819bbf126758110522b538d62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad249269819bbf126758110522b538d62">&#9670;&nbsp;</a></span>ssl_get_client_cert()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ssl_get_client_cert </td>
          <td>(</td>
          <td class="paramtype">struct SslSockData *&#160;</td>
          <td class="paramname"><em>ssldata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the client certificate for an SSL connection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ssldata</td><td>SSL socket data </td></tr>
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a> to a server </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00606">606</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;{</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_ssl_client_cert =</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <a class="code" href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_client_cert&quot;</span>);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keywordflow">if</span> (!c_ssl_client_cert)</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;Using client certificate %s\n&quot;</span>, c_ssl_client_cert);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  SSL_CTX_set_default_passwd_cb_userdata(ssldata-&gt;sctx, &amp;conn-&gt;<a class="code" href="structConnection.html#ac3c39549b6611c8eaed2a25573b5c432">account</a>);</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  SSL_CTX_set_default_passwd_cb(ssldata-&gt;sctx, <a class="code" href="openssl_8c.html#a68682ecd35358cb52878d8bcf0724e93">ssl_passwd_cb</a>);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  SSL_CTX_use_certificate_file(ssldata-&gt;sctx, c_ssl_client_cert, SSL_FILETYPE_PEM);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  SSL_CTX_use_PrivateKey_file(ssldata-&gt;sctx, c_ssl_client_cert, SSL_FILETYPE_PEM);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="comment">/* if we are using a client cert, SASL may expect an external auth name */</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="connaccount_8c.html#a2e00de19727c4db19f452dde494a770a">mutt_account_getuser</a>(&amp;conn-&gt;<a class="code" href="structConnection.html#ac3c39549b6611c8eaed2a25573b5c432">account</a>) &lt; 0)</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;Couldn&#39;t get user info\n&quot;</span>);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;}</div><div class="ttc" id="connaccount_8c_html_a2e00de19727c4db19f452dde494a770a"><div class="ttname"><a href="connaccount_8c.html#a2e00de19727c4db19f452dde494a770a">mutt_account_getuser</a></div><div class="ttdeci">int mutt_account_getuser(struct ConnAccount *cac)</div><div class="ttdoc">Retrieve username into ConnAccount, if necessary. </div><div class="ttdef"><b>Definition:</b> <a href="connaccount_8c_source.html#l00047">connaccount.c:47</a></div></div>
<div class="ttc" id="structConnection_html_ac3c39549b6611c8eaed2a25573b5c432"><div class="ttname"><a href="structConnection.html#ac3c39549b6611c8eaed2a25573b5c432">Connection::account</a></div><div class="ttdeci">struct ConnAccount account</div><div class="ttdoc">Account details: username, password, etc. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00036">connection.h:36</a></div></div>
<div class="ttc" id="structNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00036">neomutt.h:36</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a></div><div class="ttdoc">Log at debug level 2. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00041">logging.h:41</a></div></div>
<div class="ttc" id="helpers_8c_html_acadf9e29fd733422508496a70a080c09"><div class="ttname"><a href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00194">helpers.c:194</a></div></div>
<div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a></div><div class="ttdoc">Log at debug level 1. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00040">logging.h:40</a></div></div>
<div class="ttc" id="structNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00039">neomutt.h:39</a></div></div>
<div class="ttc" id="openssl_8c_html_a68682ecd35358cb52878d8bcf0724e93"><div class="ttname"><a href="openssl_8c.html#a68682ecd35358cb52878d8bcf0724e93">ssl_passwd_cb</a></div><div class="ttdeci">static int ssl_passwd_cb(char *buf, int buflen, int rwflag, void *userdata)</div><div class="ttdoc">Callback to get a password. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00336">openssl.c:336</a></div></div>
</div><!-- fragment --><div id="dynsection-25" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ad249269819bbf126758110522b538d62_cgraph.svg" width="539" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-26" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-26-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-26-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-26-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ad249269819bbf126758110522b538d62_icgraph.svg" width="284" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a580181fa12ad95a66805761f701e7cd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a580181fa12ad95a66805761f701e7cd2">&#9670;&nbsp;</a></span>ssl_socket_close_and_restore()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_socket_close_and_restore </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Close an SSL <a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a> and restore <a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a> callbacks - Implements <a class="el" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc" title="Close a socket Connection. ">Connection::close()</a> </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00627">627</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;{</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordtype">int</span> rc = <a class="code" href="openssl_8c.html#aafcc34fa7bf9d54a9323c36761353e6a">ssl_socket_close</a>(conn);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#afdd852b383b3926639ec9132c048590a">read</a> = <a class="code" href="conn_2private_8h.html#a72f2053cb73122f3ac5d0ae55e26a6c7">raw_socket_read</a>;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db">write</a> = <a class="code" href="conn_2private_8h.html#a79bb2278f55b18858b3580d8bdf53142">raw_socket_write</a>;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">close</a> = <a class="code" href="conn_2private_8h.html#a7c2227bcc35105dbeab16bec4c3fe3e6">raw_socket_close</a>;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f">poll</a> = <a class="code" href="conn_2private_8h.html#a3e4473be79d3294a1be08ab03d3f7eb6">raw_socket_poll</a>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;}</div><div class="ttc" id="conn_2private_8h_html_a7c2227bcc35105dbeab16bec4c3fe3e6"><div class="ttname"><a href="conn_2private_8h.html#a7c2227bcc35105dbeab16bec4c3fe3e6">raw_socket_close</a></div><div class="ttdeci">int raw_socket_close(struct Connection *conn)</div><div class="ttdoc">Close a socket - Implements Connection::close() </div><div class="ttdef"><b>Definition:</b> <a href="raw_8c_source.html#l00365">raw.c:365</a></div></div>
<div class="ttc" id="structConnection_html_afdd852b383b3926639ec9132c048590a"><div class="ttname"><a href="structConnection.html#afdd852b383b3926639ec9132c048590a">Connection::read</a></div><div class="ttdeci">int(* read)(struct Connection *conn, char *buf, size_t count)</div><div class="ttdoc">Read from a socket Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00072">connection.h:72</a></div></div>
<div class="ttc" id="conn_2private_8h_html_a3e4473be79d3294a1be08ab03d3f7eb6"><div class="ttname"><a href="conn_2private_8h.html#a3e4473be79d3294a1be08ab03d3f7eb6">raw_socket_poll</a></div><div class="ttdeci">int raw_socket_poll(struct Connection *conn, time_t wait_secs)</div><div class="ttdoc">Checks whether reads would block - Implements Connection::poll() </div><div class="ttdef"><b>Definition:</b> <a href="raw_8c_source.html#l00327">raw.c:327</a></div></div>
<div class="ttc" id="conn_2private_8h_html_a79bb2278f55b18858b3580d8bdf53142"><div class="ttname"><a href="conn_2private_8h.html#a79bb2278f55b18858b3580d8bdf53142">raw_socket_write</a></div><div class="ttdeci">int raw_socket_write(struct Connection *conn, const char *buf, size_t count)</div><div class="ttdoc">Write data to a socket - Implements Connection::write() </div><div class="ttdef"><b>Definition:</b> <a href="raw_8c_source.html#l00297">raw.c:297</a></div></div>
<div class="ttc" id="structConnection_html_a7a40be1f125477cf01ced6817be10bbc"><div class="ttname"><a href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">Connection::close</a></div><div class="ttdeci">int(* close)(struct Connection *conn)</div><div class="ttdoc">Close a socket Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00100">connection.h:100</a></div></div>
<div class="ttc" id="conn_2private_8h_html_a72f2053cb73122f3ac5d0ae55e26a6c7"><div class="ttname"><a href="conn_2private_8h.html#a72f2053cb73122f3ac5d0ae55e26a6c7">raw_socket_read</a></div><div class="ttdeci">int raw_socket_read(struct Connection *conn, char *buf, size_t len)</div><div class="ttdoc">Read data from a socket - Implements Connection::read() </div><div class="ttdef"><b>Definition:</b> <a href="raw_8c_source.html#l00267">raw.c:267</a></div></div>
<div class="ttc" id="structConnection_html_a2fcded23739f26da564cdb378c8b0a4f"><div class="ttname"><a href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f">Connection::poll</a></div><div class="ttdeci">int(* poll)(struct Connection *conn, time_t wait_secs)</div><div class="ttdoc">Check whether a socket read would block. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00092">connection.h:92</a></div></div>
<div class="ttc" id="structConnection_html_a3b376a9471b5c0ecf43968239bf8c2db"><div class="ttname"><a href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db">Connection::write</a></div><div class="ttdeci">int(* write)(struct Connection *conn, const char *buf, size_t count)</div><div class="ttdoc">Write to a socket Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00082">connection.h:82</a></div></div>
<div class="ttc" id="openssl_8c_html_aafcc34fa7bf9d54a9323c36761353e6a"><div class="ttname"><a href="openssl_8c.html#aafcc34fa7bf9d54a9323c36761353e6a">ssl_socket_close</a></div><div class="ttdeci">static int ssl_socket_close(struct Connection *conn)</div><div class="ttdoc">Close an SSL connection - Implements Connection::close() </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01390">openssl.c:1390</a></div></div>
</div><!-- fragment --><div id="dynsection-27" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-27-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-27-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-27-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a580181fa12ad95a66805761f701e7cd2_cgraph.svg" width="543" height="215"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-28" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-28-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-28-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-28-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a580181fa12ad95a66805761f701e7cd2_icgraph.svg" width="352" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5f1104e3e22a4015529223f2288398f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f1104e3e22a4015529223f2288398f3">&#9670;&nbsp;</a></span>check_certificate_cache()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_certificate_cache </td>
          <td>(</td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>peercert</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Is the X509 Certificate in the cache? </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peercert</td><td>Certificate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificate is in the cache </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00643">643</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;{</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> peermd[EVP_MAX_MD_SIZE];</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> peermdlen;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  X509 *cert = NULL;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="keywordflow">if</span> (!X509_digest(peercert, EVP_sha256(), peermd, &amp;peermdlen) || !SslSessionCerts)</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = sk_X509_num(SslSessionCerts); i-- &gt; 0;)</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    cert = sk_X509_value(SslSessionCerts, i);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="openssl_8c.html#a4beebc53c57442012424fe2dcfcada63">compare_certificates</a>(cert, peercert, peermd, peermdlen))</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;}</div><div class="ttc" id="openssl_8c_html_a4beebc53c57442012424fe2dcfcada63"><div class="ttname"><a href="openssl_8c.html#a4beebc53c57442012424fe2dcfcada63">compare_certificates</a></div><div class="ttdeci">static bool compare_certificates(X509 *cert, X509 *peercert, unsigned char *peermd, unsigned int peermdlen)</div><div class="ttdoc">Compare two X509 certificated. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00440">openssl.c:440</a></div></div>
</div><!-- fragment --><div id="dynsection-29" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-29-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-29-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-29-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a5f1104e3e22a4015529223f2288398f3_cgraph.svg" width="395" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-30" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-30-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-30-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-30-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a5f1104e3e22a4015529223f2288398f3_icgraph.svg" width="383" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ada3c8409337c74100a934208b0551be0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada3c8409337c74100a934208b0551be0">&#9670;&nbsp;</a></span>check_certificate_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_certificate_file </td>
          <td>(</td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>peercert</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read and check a certificate file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peercert</td><td>Certificate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificate is valid </td></tr>
    <tr><td class="paramname">false</td><td>Error, or certificate is invalid </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00672">672</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;{</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> peermd[EVP_MAX_MD_SIZE];</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> peermdlen;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  X509 *cert = NULL;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordtype">int</span> pass = <span class="keyword">false</span>;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  FILE *fp = NULL;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_certificate_file =</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <a class="code" href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;certificate_file&quot;</span>);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  fp = <a class="code" href="file_8c.html#ae1c0c19fec03274220b3ca065ad1e2e5">mutt_file_fopen</a>(c_certificate_file, <span class="stringliteral">&quot;rt&quot;</span>);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="keywordflow">if</span> (!fp)</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordflow">if</span> (!X509_digest(peercert, EVP_sha256(), peermd, &amp;peermdlen))</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="file_8c.html#a31f49795ff5b9558db5476e5777e63b6">mutt_file_fclose</a>(&amp;fp);</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  }</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordflow">while</span> (PEM_read_X509(fp, &amp;cert, NULL, NULL))</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="openssl_8c.html#a4beebc53c57442012424fe2dcfcada63">compare_certificates</a>(cert, peercert, peermd, peermdlen) &amp;&amp;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <a class="code" href="openssl_8c.html#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a>(cert, <span class="keyword">true</span>))</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      pass = <span class="keyword">true</span>;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="comment">/* PEM_read_X509 sets an error on eof */</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordflow">if</span> (!pass)</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    ERR_clear_error();</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  X509_free(cert);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <a class="code" href="file_8c.html#a31f49795ff5b9558db5476e5777e63b6">mutt_file_fclose</a>(&amp;fp);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordflow">return</span> pass;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;}</div><div class="ttc" id="openssl_8c_html_a4beebc53c57442012424fe2dcfcada63"><div class="ttname"><a href="openssl_8c.html#a4beebc53c57442012424fe2dcfcada63">compare_certificates</a></div><div class="ttdeci">static bool compare_certificates(X509 *cert, X509 *peercert, unsigned char *peermd, unsigned int peermdlen)</div><div class="ttdoc">Compare two X509 certificated. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00440">openssl.c:440</a></div></div>
<div class="ttc" id="structNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00036">neomutt.h:36</a></div></div>
<div class="ttc" id="file_8c_html_a31f49795ff5b9558db5476e5777e63b6"><div class="ttname"><a href="file_8c.html#a31f49795ff5b9558db5476e5777e63b6">mutt_file_fclose</a></div><div class="ttdeci">int mutt_file_fclose(FILE **fp)</div><div class="ttdoc">Close a FILE handle (and NULL the pointer) </div><div class="ttdef"><b>Definition:</b> <a href="file_8c_source.html#l00153">file.c:153</a></div></div>
<div class="ttc" id="helpers_8c_html_acadf9e29fd733422508496a70a080c09"><div class="ttname"><a href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00194">helpers.c:194</a></div></div>
<div class="ttc" id="openssl_8c_html_ad29824f6d037bbefe08d5551fafabe74"><div class="ttname"><a href="openssl_8c.html#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a></div><div class="ttdeci">static bool check_certificate_expiration(X509 *peercert, bool silent)</div><div class="ttdoc">Check if a certificate has expired. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00470">openssl.c:470</a></div></div>
<div class="ttc" id="structNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00039">neomutt.h:39</a></div></div>
<div class="ttc" id="file_8c_html_ae1c0c19fec03274220b3ca065ad1e2e5"><div class="ttname"><a href="file_8c.html#ae1c0c19fec03274220b3ca065ad1e2e5">mutt_file_fopen</a></div><div class="ttdeci">FILE * mutt_file_fopen(const char *path, const char *mode)</div><div class="ttdoc">Call fopen() safely. </div><div class="ttdef"><b>Definition:</b> <a href="file_8c_source.html#l00589">file.c:589</a></div></div>
</div><!-- fragment --><div id="dynsection-31" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-31-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-31-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-31-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ada3c8409337c74100a934208b0551be0_cgraph.svg" width="423" height="240"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-32" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-32-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-32-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-32-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ada3c8409337c74100a934208b0551be0_icgraph.svg" width="372" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a039081100802f18e9d2fb80b492e61ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a039081100802f18e9d2fb80b492e61ac">&#9670;&nbsp;</a></span>check_host()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int check_host </td>
          <td>(</td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>x509cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>hostname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>err</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>errlen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check the host on the certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">x509cert</td><td>Certificate </td></tr>
    <tr><td class="paramname">hostname</td><td>Hostname </td></tr>
    <tr><td class="paramname">err</td><td><a class="el" href="structBuffer.html" title="String manipulation buffer. ">Buffer</a> for error message </td></tr>
    <tr><td class="paramname">errlen</td><td>Length of buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>Hostname matches the certificate </td></tr>
    <tr><td class="paramname">0</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00719">719</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;{</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordtype">int</span> rc = 0;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="comment">/* hostname in ASCII format: */</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordtype">char</span> *hostname_ascii = NULL;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="comment">/* needed to get the common name: */</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  X509_NAME *x509_subject = NULL;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordtype">char</span> *buf = NULL;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="keywordtype">int</span> bufsize;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="comment">/* needed to get the DNS subjectAltNames: */</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <a class="code" href="openssl_8c.html#a42856d46ab73f3511a5353d4e30af6d4">STACK_OF</a>(GENERAL_NAME) * subj_alt_names;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="keywordtype">int</span> subj_alt_names_count;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  GENERAL_NAME *subj_alt_name = NULL;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="comment">/* did we find a name matching hostname? */</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="keywordtype">bool</span> match_found;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="comment">/* Check if &#39;hostname&#39; matches the one of the subjectAltName extensions of</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">   * type DNS or the Common Name (CN). */</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="preprocessor">#ifdef HAVE_LIBIDN</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="idna2_8h.html#a245452209019d6bc1eed6f6f341eccf2">mutt_idna_to_ascii_lz</a>(hostname, &amp;hostname_ascii, 0) != 0)</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    hostname_ascii = <a class="code" href="mutt_2string_8c.html#a4c2560f787bd1226b977992c16860c98">mutt_str_dup</a>(hostname);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  hostname_ascii = <a class="code" href="mutt_2string_8c.html#a4c2560f787bd1226b977992c16860c98">mutt_str_dup</a>(hostname);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="comment">/* Try the DNS subjectAltNames. */</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  match_found = <span class="keyword">false</span>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  subj_alt_names = X509_get_ext_d2i(x509cert, NID_subject_alt_name, NULL, NULL);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="keywordflow">if</span> (subj_alt_names)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    subj_alt_names_count = sk_GENERAL_NAME_num(subj_alt_names);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; subj_alt_names_count; i++)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    {</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      subj_alt_name = sk_GENERAL_NAME_value(subj_alt_names, i);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="keywordflow">if</span> (subj_alt_name-&gt;type == GEN_DNS)</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      {</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">if</span> ((subj_alt_name-&gt;d.ia5-&gt;length &gt;= 0) &amp;&amp;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            (<a class="code" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>((<span class="keywordtype">char</span> *) subj_alt_name-&gt;d.ia5-&gt;data) ==</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;             (<span class="keywordtype">size_t</span>) subj_alt_name-&gt;d.ia5-&gt;length) &amp;&amp;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            (match_found = <a class="code" href="openssl_8c.html#ae39adc817bff49725d338570174c4a0b">hostname_match</a>(hostname_ascii,</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                                          (<span class="keywordtype">char</span> *) (subj_alt_name-&gt;d.ia5-&gt;data))))</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        }</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    GENERAL_NAMES_free(subj_alt_names);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordflow">if</span> (!match_found)</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="comment">/* Try the common name */</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    x509_subject = X509_get_subject_name(x509cert);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">if</span> (!x509_subject)</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    {</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="keywordflow">if</span> (err &amp;&amp; errlen)</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <a class="code" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(err, <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;can&#39;t get certificate subject&quot;</span>), errlen);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    }</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">/* first get the space requirements */</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    bufsize = X509_NAME_get_text_by_NID(x509_subject, NID_commonName, NULL, 0);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">if</span> (bufsize == -1)</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    {</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="keywordflow">if</span> (err &amp;&amp; errlen)</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <a class="code" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(err, <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;can&#39;t get certificate common name&quot;</span>), errlen);</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    }</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    bufsize++; <span class="comment">/* space for the terminal nul char */</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    buf = <a class="code" href="memory_8c.html#a264da4dc58e6dc8983285bd1f538f24d">mutt_mem_malloc</a>((<span class="keywordtype">size_t</span>) bufsize);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">if</span> (X509_NAME_get_text_by_NID(x509_subject, NID_commonName, buf, bufsize) == -1)</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    {</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <span class="keywordflow">if</span> (err &amp;&amp; errlen)</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <a class="code" href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a>(err, <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;can&#39;t get certificate common name&quot;</span>), errlen);</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    }</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="comment">/* cast is safe since bufsize is incremented above, so bufsize-1 is always</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">     * zero or greater.  */</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>(buf) == (<span class="keywordtype">size_t</span>) bufsize - 1)</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      match_found = <a class="code" href="openssl_8c.html#ae39adc817bff49725d338570174c4a0b">hostname_match</a>(hostname_ascii, buf);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    }</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  }</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordflow">if</span> (!match_found)</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  {</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">if</span> (err &amp;&amp; errlen)</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      snprintf(err, errlen, <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;certificate owner does not match hostname %s&quot;</span>), hostname);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  }</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  rc = 1;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;out:</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <a class="code" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;buf);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <a class="code" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;hostname_ascii);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;}</div><div class="ttc" id="mutt_2string_8c_html_a4c2560f787bd1226b977992c16860c98"><div class="ttname"><a href="mutt_2string_8c.html#a4c2560f787bd1226b977992c16860c98">mutt_str_dup</a></div><div class="ttdeci">char * mutt_str_dup(const char *str)</div><div class="ttdoc">Copy a string, safely. </div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00370">string.c:370</a></div></div>
<div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="idna2_8h_html_a245452209019d6bc1eed6f6f341eccf2"><div class="ttname"><a href="idna2_8h.html#a245452209019d6bc1eed6f6f341eccf2">mutt_idna_to_ascii_lz</a></div><div class="ttdeci">int mutt_idna_to_ascii_lz(const char *input, char **output, uint8_t flags)</div></div>
<div class="ttc" id="memory_8c_html_a264da4dc58e6dc8983285bd1f538f24d"><div class="ttname"><a href="memory_8c.html#a264da4dc58e6dc8983285bd1f538f24d">mutt_mem_malloc</a></div><div class="ttdeci">void * mutt_mem_malloc(size_t size)</div><div class="ttdoc">Allocate memory on the heap. </div><div class="ttdef"><b>Definition:</b> <a href="memory_8c_source.html#l00090">memory.c:90</a></div></div>
<div class="ttc" id="openssl_8c_html_a42856d46ab73f3511a5353d4e30af6d4"><div class="ttname"><a href="openssl_8c.html#a42856d46ab73f3511a5353d4e30af6d4">STACK_OF</a></div><div class="ttdeci">static STACK_OF(X509)</div><div class="ttdoc">SSL socket data -. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00090">openssl.c:90</a></div></div>
<div class="ttc" id="mutt_2string_8c_html_acca6786b903b22a5924219f9db96e10d"><div class="ttname"><a href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a></div><div class="ttdeci">size_t mutt_str_len(const char *a)</div><div class="ttdoc">Calculate the length of a string, safely. </div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00664">string.c:664</a></div></div>
<div class="ttc" id="mutt_2string_8c_html_ad20e00309de897a1e882fc7400335b83"><div class="ttname"><a href="mutt_2string_8c.html#ad20e00309de897a1e882fc7400335b83">mutt_str_copy</a></div><div class="ttdeci">size_t mutt_str_copy(char *dest, const char *src, size_t dsize)</div><div class="ttdoc">Copy a string into a buffer (guaranteeing NUL-termination) </div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00749">string.c:749</a></div></div>
<div class="ttc" id="memory_8h_html_a25875003b43b81a4302256caa4a13599"><div class="ttname"><a href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a></div><div class="ttdeci">#define FREE(x)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00040">memory.h:40</a></div></div>
<div class="ttc" id="openssl_8c_html_ae39adc817bff49725d338570174c4a0b"><div class="ttname"><a href="openssl_8c.html#ae39adc817bff49725d338570174c4a0b">hostname_match</a></div><div class="ttdeci">static bool hostname_match(const char *hostname, const char *certname)</div><div class="ttdoc">Does the hostname match the certificate. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00506">openssl.c:506</a></div></div>
</div><!-- fragment --><div id="dynsection-33" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-33-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-33-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-33-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a039081100802f18e9d2fb80b492e61ac_cgraph.svg" width="316" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-34" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-34-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-34-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-34-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a039081100802f18e9d2fb80b492e61ac_icgraph.svg" width="300" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="afdbe2b83fcf6173cf72e7f729f230a72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdbe2b83fcf6173cf72e7f729f230a72">&#9670;&nbsp;</a></span>check_certificate_by_digest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_certificate_by_digest </td>
          <td>(</td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>peercert</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Validate a certificate by its digest. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peercert</td><td>Certificate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificate is valid </td></tr>
    <tr><td class="paramname">false</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00828">828</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;{</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="openssl_8c.html#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a>(peercert, <span class="keyword">false</span>) &amp;&amp; <a class="code" href="openssl_8c.html#ada3c8409337c74100a934208b0551be0">check_certificate_file</a>(peercert);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;}</div><div class="ttc" id="openssl_8c_html_ada3c8409337c74100a934208b0551be0"><div class="ttname"><a href="openssl_8c.html#ada3c8409337c74100a934208b0551be0">check_certificate_file</a></div><div class="ttdeci">static bool check_certificate_file(X509 *peercert)</div><div class="ttdoc">Read and check a certificate file. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00672">openssl.c:672</a></div></div>
<div class="ttc" id="openssl_8c_html_ad29824f6d037bbefe08d5551fafabe74"><div class="ttname"><a href="openssl_8c.html#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a></div><div class="ttdeci">static bool check_certificate_expiration(X509 *peercert, bool silent)</div><div class="ttdoc">Check if a certificate has expired. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00470">openssl.c:470</a></div></div>
</div><!-- fragment --><div id="dynsection-35" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-35-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-35-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-35-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_afdbe2b83fcf6173cf72e7f729f230a72_cgraph.svg" width="626" height="71"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-36" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-36-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-36-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-36-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_afdbe2b83fcf6173cf72e7f729f230a72_icgraph.svg" width="360" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab8bbb9fa54bc203070165c84f273cb0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8bbb9fa54bc203070165c84f273cb0f">&#9670;&nbsp;</a></span>ssl_cache_trusted_cert()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_cache_trusted_cert </td>
          <td>(</td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Cache a trusted certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">c</td><td>Certificate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">&gt;0</td><td>Number of elements in the cache </td></tr>
    <tr><td class="paramname">0</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00839">839</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;{</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;trusted\n&quot;</span>);</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="keywordflow">if</span> (!SslSessionCerts)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    SslSessionCerts = sk_X509_new_null();</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordflow">return</span> sk_X509_push(SslSessionCerts, X509_dup(c));</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;}</div><div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a></div><div class="ttdoc">Log at debug level 1. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00040">logging.h:40</a></div></div>
</div><!-- fragment --><div id="dynsection-37" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-37-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-37-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-37-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ab8bbb9fa54bc203070165c84f273cb0f_icgraph.svg" width="399" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa441cecbfccdb3f5d2afd621a696d2b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa441cecbfccdb3f5d2afd621a696d2b5">&#9670;&nbsp;</a></span>add_cert()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void add_cert </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>title</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>issuer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct ListHead *&#160;</td>
          <td class="paramname"><em>list</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Look up certificate info and save it to a list. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">title</td><td>Title for this block of certificate info </td></tr>
    <tr><td class="paramname">cert</td><td>Certificate </td></tr>
    <tr><td class="paramname">issuer</td><td>If true, look up the issuer rather than owner details </td></tr>
    <tr><td class="paramname">list</td><td>List to save info to </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00854">854</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;{</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> part[] = {</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    NID_commonName,             <span class="comment">// CN</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    NID_pkcs9_emailAddress,     <span class="comment">// Email</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    NID_organizationName,       <span class="comment">// O</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    NID_organizationalUnitName, <span class="comment">// OU</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    NID_localityName,           <span class="comment">// L</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    NID_stateOrProvinceName,    <span class="comment">// ST</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    NID_countryName,            <span class="comment">// C</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  };</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  X509_NAME *x509 = NULL;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keywordflow">if</span> (issuer)</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    x509 = X509_get_issuer_name(cert);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    x509 = X509_get_subject_name(cert);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="comment">// Allocate formatted strings and let the ListHead take ownership</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(list, <a class="code" href="mutt_2string_8c.html#a4c2560f787bd1226b977992c16860c98">mutt_str_dup</a>(title));</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">char</span> *line = NULL;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordtype">char</span> *text = NULL;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="memory_8h.html#afe62718c7d5ad088c3ea1dc4c28ccea3">mutt_array_size</a>(part); i++)</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  {</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    text = <a class="code" href="openssl_8c.html#a6ffadaf8220389dd2d422db1daaf46aa">x509_get_part</a>(x509, part[i]);</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="keywordflow">if</span> (text)</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    {</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <a class="code" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <span class="stringliteral">&quot;   %s&quot;</span>, text);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(list, line);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    }</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  }</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;}</div><div class="ttc" id="mutt_2string_8c_html_a4c2560f787bd1226b977992c16860c98"><div class="ttname"><a href="mutt_2string_8c.html#a4c2560f787bd1226b977992c16860c98">mutt_str_dup</a></div><div class="ttdeci">char * mutt_str_dup(const char *str)</div><div class="ttdoc">Copy a string, safely. </div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00370">string.c:370</a></div></div>
<div class="ttc" id="memory_8h_html_afe62718c7d5ad088c3ea1dc4c28ccea3"><div class="ttname"><a href="memory_8h.html#afe62718c7d5ad088c3ea1dc4c28ccea3">mutt_array_size</a></div><div class="ttdeci">#define mutt_array_size(x)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00033">memory.h:33</a></div></div>
<div class="ttc" id="list_8c_html_ace47a64c8bec9d1b24be6524f650293d"><div class="ttname"><a href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a></div><div class="ttdeci">struct ListNode * mutt_list_insert_tail(struct ListHead *h, char *s)</div><div class="ttdoc">Append a string to the end of a List. </div><div class="ttdef"><b>Definition:</b> <a href="list_8c_source.html#l00064">list.c:64</a></div></div>
<div class="ttc" id="openssl_8c_html_a6ffadaf8220389dd2d422db1daaf46aa"><div class="ttname"><a href="openssl_8c.html#a6ffadaf8220389dd2d422db1daaf46aa">x509_get_part</a></div><div class="ttdeci">static char * x509_get_part(X509_NAME *name, int nid)</div><div class="ttdoc">Retrieve from X509 data. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00369">openssl.c:369</a></div></div>
<div class="ttc" id="mutt_2string_8c_html_a4388c16988fac9a7596dee4d4af89595"><div class="ttname"><a href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a></div><div class="ttdeci">int mutt_str_asprintf(char **strp, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l01128">string.c:1128</a></div></div>
</div><!-- fragment --><div id="dynsection-38" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-38-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-38-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-38-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aa441cecbfccdb3f5d2afd621a696d2b5_cgraph.svg" width="290" height="190"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-39" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-39-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-39-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-39-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aa441cecbfccdb3f5d2afd621a696d2b5_icgraph.svg" width="307" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ae0a15dc5df31b626a42f31bd6a5ea7f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0a15dc5df31b626a42f31bd6a5ea7f4">&#9670;&nbsp;</a></span>interactive_check_cert()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool interactive_check_cert </td>
          <td>(</td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL *&#160;</td>
          <td class="paramname"><em>ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>allow_always</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Ask the user if a certificate is valid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cert</td><td>Certificate </td></tr>
    <tr><td class="paramname">idx</td><td>Place of certificate in the chain </td></tr>
    <tr><td class="paramname">len</td><td>Length of the certificate chain </td></tr>
    <tr><td class="paramname">ssl</td><td>SSL state </td></tr>
    <tr><td class="paramname">allow_always</td><td>If certificate may be always allowed </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>User selected 'skip' </td></tr>
    <tr><td class="paramname">false</td><td>Otherwise </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00898">898</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;{</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordtype">char</span> buf[256];</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keyword">struct </span>ListHead list = <a class="code" href="queue_8h.html#a3d41ce2c3f1dd21c0d4051d13204c321">STAILQ_HEAD_INITIALIZER</a>(list);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <a class="code" href="openssl_8c.html#aa441cecbfccdb3f5d2afd621a696d2b5">add_cert</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;This certificate belongs to:&quot;</span>), cert, <span class="keyword">false</span>, &amp;list);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(&amp;list, NULL);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <a class="code" href="openssl_8c.html#aa441cecbfccdb3f5d2afd621a696d2b5">add_cert</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;This certificate was issued by:&quot;</span>), cert, <span class="keyword">true</span>, &amp;list);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="keywordtype">char</span> *line = NULL;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(&amp;list, NULL);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(&amp;list, <a class="code" href="mutt_2string_8c.html#a4c2560f787bd1226b977992c16860c98">mutt_str_dup</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;This certificate is valid&quot;</span>)));</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <a class="code" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;   from %s&quot;</span>), <a class="code" href="openssl_8c.html#aa654a0adad3010a4d0d68fae41742816">asn1time_to_string</a>(X509_getm_notBefore(cert)));</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(&amp;list, line);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <a class="code" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;     to %s&quot;</span>), <a class="code" href="openssl_8c.html#aa654a0adad3010a4d0d68fae41742816">asn1time_to_string</a>(X509_getm_notAfter(cert)));</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(&amp;list, line);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(&amp;list, NULL);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  buf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <a class="code" href="openssl_8c.html#add87edd5fed87dd2b4845b43f4a588d3">x509_fingerprint</a>(buf, <span class="keyword">sizeof</span>(buf), cert, EVP_sha1);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <a class="code" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SHA1 Fingerprint: %s&quot;</span>), buf);</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(&amp;list, line);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  buf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  buf[40] = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">/* Ensure the second printed line is null terminated */</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <a class="code" href="openssl_8c.html#add87edd5fed87dd2b4845b43f4a588d3">x509_fingerprint</a>(buf, <span class="keyword">sizeof</span>(buf), cert, EVP_sha256);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  buf[39] = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">/* Divide into two lines of output */</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <a class="code" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <span class="stringliteral">&quot;%s%s&quot;</span>, <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SHA256 Fingerprint: &quot;</span>), buf);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(&amp;list, line);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <a class="code" href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a>(&amp;line, <span class="stringliteral">&quot;%*s%s&quot;</span>,</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                    (<span class="keywordtype">int</span>) <a class="code" href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SHA256 Fingerprint: &quot;</span>)), <span class="stringliteral">&quot;&quot;</span>, buf + 40);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <a class="code" href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a>(&amp;list, line);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="keywordtype">bool</span> allow_skip = <span class="keyword">false</span>;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">/* The leaf/host certificate can&#39;t be skipped. */</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="preprocessor">#ifdef HAVE_SSL_PARTIAL_CHAIN</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_verify_partial_chains =</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_verify_partial_chains&quot;</span>);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="mailbox_8c.html#a103fe1fcacccda7d9cdacde44721faef">idx</a> != 0) &amp;&amp; c_ssl_verify_partial_chains)</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    allow_skip = <span class="keyword">true</span>;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keywordtype">char</span> title[256];</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  snprintf(title, <span class="keyword">sizeof</span>(title),</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;           <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SSL Certificate check (certificate %zu of %zu in chain)&quot;</span>), len - <a class="code" href="mailbox_8c.html#a103fe1fcacccda7d9cdacde44721faef">idx</a>, len);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="comment">/* Inside ssl_verify_callback(), this function is guarded by a call to</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">   * check_certificate_by_digest().  This means if check_certificate_expiration() is</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">   * true, then check_certificate_file() must be false.  Therefore we don&#39;t need</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">   * to also scan the certificate file here.  */</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_certificate_file =</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <a class="code" href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;certificate_file&quot;</span>);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  allow_always = allow_always &amp;&amp; c_certificate_file &amp;&amp;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                 <a class="code" href="openssl_8c.html#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a>(cert, <span class="keyword">true</span>);</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordtype">int</span> rc = <a class="code" href="dlgverifycert_8c.html#afc4acbc5f5fde85c72316cfbce697955">dlg_verify_certificate</a>(title, &amp;list, allow_always, allow_skip);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="keywordflow">if</span> ((rc == 3) &amp;&amp; !allow_always)</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    rc = 4;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordflow">switch</span> (rc)</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  {</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordflow">case</span> 1: <span class="comment">// Reject</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keywordflow">case</span> 2: <span class="comment">// Once</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      SSL_set_ex_data(ssl, <a class="code" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, NULL);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <a class="code" href="openssl_8c.html#ab8bbb9fa54bc203070165c84f273cb0f">ssl_cache_trusted_cert</a>(cert);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">case</span> 3: <span class="comment">// Always</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      <span class="keywordtype">bool</span> saved = <span class="keyword">false</span>;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      FILE *fp = <a class="code" href="file_8c.html#ae1c0c19fec03274220b3ca065ad1e2e5">mutt_file_fopen</a>(c_certificate_file, <span class="stringliteral">&quot;a&quot;</span>);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="keywordflow">if</span> (fp)</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <span class="keywordflow">if</span> (PEM_write_X509(fp, cert))</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;          saved = <span class="keyword">true</span>;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <a class="code" href="file_8c.html#a31f49795ff5b9558db5476e5777e63b6">mutt_file_fclose</a>(&amp;fp);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      }</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="keywordflow">if</span> (saved)</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <a class="code" href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Certificate saved&quot;</span>));</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Warning: Couldn&#39;t save certificate&quot;</span>));</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      SSL_set_ex_data(ssl, <a class="code" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, NULL);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <a class="code" href="openssl_8c.html#ab8bbb9fa54bc203070165c84f273cb0f">ssl_cache_trusted_cert</a>(cert);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    }</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keywordflow">case</span> 4: <span class="comment">// Skip</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      SSL_set_ex_data(ssl, <a class="code" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, &amp;<a class="code" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  }</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <a class="code" href="list_8c.html#ab5c53ce94cc2aafa4299dbc81a37f4a4">mutt_list_free</a>(&amp;list);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keywordflow">return</span> (rc &gt; 1);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;}</div><div class="ttc" id="openssl_8c_html_aa654a0adad3010a4d0d68fae41742816"><div class="ttname"><a href="openssl_8c.html#aa654a0adad3010a4d0d68fae41742816">asn1time_to_string</a></div><div class="ttdeci">static char * asn1time_to_string(ASN1_UTCTIME *tm)</div><div class="ttdoc">Convert a time to a string. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00413">openssl.c:413</a></div></div>
<div class="ttc" id="helpers_8c_html_ae50f679dd6c5bd1ba820884c8602f038"><div class="ttname"><a href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a></div><div class="ttdeci">bool cs_subset_bool(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a boolean config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00073">helpers.c:73</a></div></div>
<div class="ttc" id="openssl_8c_html_aa441cecbfccdb3f5d2afd621a696d2b5"><div class="ttname"><a href="openssl_8c.html#aa441cecbfccdb3f5d2afd621a696d2b5">add_cert</a></div><div class="ttdeci">static void add_cert(const char *title, X509 *cert, bool issuer, struct ListHead *list)</div><div class="ttdoc">Look up certificate info and save it to a list. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00854">openssl.c:854</a></div></div>
<div class="ttc" id="group__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00088">logging.h:88</a></div></div>
<div class="ttc" id="mailbox_8c_html_a103fe1fcacccda7d9cdacde44721faef"><div class="ttname"><a href="mailbox_8c.html#a103fe1fcacccda7d9cdacde44721faef">idx</a></div><div class="ttdeci">size_t idx</div><div class="ttdef"><b>Definition:</b> <a href="mailbox_8c_source.html#l00257">mailbox.c:257</a></div></div>
<div class="ttc" id="mutt_2string_8c_html_a4c2560f787bd1226b977992c16860c98"><div class="ttname"><a href="mutt_2string_8c.html#a4c2560f787bd1226b977992c16860c98">mutt_str_dup</a></div><div class="ttdeci">char * mutt_str_dup(const char *str)</div><div class="ttdoc">Copy a string, safely. </div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00370">string.c:370</a></div></div>
<div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="structNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00036">neomutt.h:36</a></div></div>
<div class="ttc" id="list_8c_html_ab5c53ce94cc2aafa4299dbc81a37f4a4"><div class="ttname"><a href="list_8c.html#ab5c53ce94cc2aafa4299dbc81a37f4a4">mutt_list_free</a></div><div class="ttdeci">void mutt_list_free(struct ListHead *h)</div><div class="ttdoc">Free a List AND its strings. </div><div class="ttdef"><b>Definition:</b> <a href="list_8c_source.html#l00122">list.c:122</a></div></div>
<div class="ttc" id="file_8c_html_a31f49795ff5b9558db5476e5777e63b6"><div class="ttname"><a href="file_8c.html#a31f49795ff5b9558db5476e5777e63b6">mutt_file_fclose</a></div><div class="ttdeci">int mutt_file_fclose(FILE **fp)</div><div class="ttdoc">Close a FILE handle (and NULL the pointer) </div><div class="ttdef"><b>Definition:</b> <a href="file_8c_source.html#l00153">file.c:153</a></div></div>
<div class="ttc" id="list_8c_html_ace47a64c8bec9d1b24be6524f650293d"><div class="ttname"><a href="list_8c.html#ace47a64c8bec9d1b24be6524f650293d">mutt_list_insert_tail</a></div><div class="ttdeci">struct ListNode * mutt_list_insert_tail(struct ListHead *h, char *s)</div><div class="ttdoc">Append a string to the end of a List. </div><div class="ttdef"><b>Definition:</b> <a href="list_8c_source.html#l00064">list.c:64</a></div></div>
<div class="ttc" id="openssl_8c_html_ab8bbb9fa54bc203070165c84f273cb0f"><div class="ttname"><a href="openssl_8c.html#ab8bbb9fa54bc203070165c84f273cb0f">ssl_cache_trusted_cert</a></div><div class="ttdeci">static int ssl_cache_trusted_cert(X509 *c)</div><div class="ttdoc">Cache a trusted certificate. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00839">openssl.c:839</a></div></div>
<div class="ttc" id="helpers_8c_html_acadf9e29fd733422508496a70a080c09"><div class="ttname"><a href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00194">helpers.c:194</a></div></div>
<div class="ttc" id="dlgverifycert_8c_html_afc4acbc5f5fde85c72316cfbce697955"><div class="ttname"><a href="dlgverifycert_8c.html#afc4acbc5f5fde85c72316cfbce697955">dlg_verify_certificate</a></div><div class="ttdeci">int dlg_verify_certificate(const char *title, struct ListHead *list, bool allow_always, bool allow_skip)</div><div class="ttdoc">Ask the user to validate the certificate. </div><div class="ttdef"><b>Definition:</b> <a href="dlgverifycert_8c_source.html#l00092">dlgverifycert.c:92</a></div></div>
<div class="ttc" id="openssl_8c_html_add87edd5fed87dd2b4845b43f4a588d3"><div class="ttname"><a href="openssl_8c.html#add87edd5fed87dd2b4845b43f4a588d3">x509_fingerprint</a></div><div class="ttdeci">static void x509_fingerprint(char *s, int l, X509 *cert, const EVP_MD *(*hashfunc)(void))</div><div class="ttdoc">Generate a fingerprint for an X509 certificate. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00386">openssl.c:386</a></div></div>
<div class="ttc" id="mutt_2string_8c_html_acca6786b903b22a5924219f9db96e10d"><div class="ttname"><a href="mutt_2string_8c.html#acca6786b903b22a5924219f9db96e10d">mutt_str_len</a></div><div class="ttdeci">size_t mutt_str_len(const char *a)</div><div class="ttdoc">Calculate the length of a string, safely. </div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l00664">string.c:664</a></div></div>
<div class="ttc" id="openssl_8c_html_af84a999f737b3cc63228cecc117a5d87"><div class="ttname"><a href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a></div><div class="ttdeci">static int SkipModeExDataIndex</div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00086">openssl.c:86</a></div></div>
<div class="ttc" id="group__logging__api_html_gae108f891125caafa9250cf0959c40c04"><div class="ttname"><a href="group__logging__api.html#gae108f891125caafa9250cf0959c40c04">mutt_message</a></div><div class="ttdeci">#define mutt_message(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00087">logging.h:87</a></div></div>
<div class="ttc" id="queue_8h_html_a3d41ce2c3f1dd21c0d4051d13204c321"><div class="ttname"><a href="queue_8h.html#a3d41ce2c3f1dd21c0d4051d13204c321">STAILQ_HEAD_INITIALIZER</a></div><div class="ttdeci">#define STAILQ_HEAD_INITIALIZER(head)</div><div class="ttdef"><b>Definition:</b> <a href="queue_8h_source.html#l00324">queue.h:324</a></div></div>
<div class="ttc" id="openssl_8c_html_ad29824f6d037bbefe08d5551fafabe74"><div class="ttname"><a href="openssl_8c.html#ad29824f6d037bbefe08d5551fafabe74">check_certificate_expiration</a></div><div class="ttdeci">static bool check_certificate_expiration(X509 *peercert, bool silent)</div><div class="ttdoc">Check if a certificate has expired. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00470">openssl.c:470</a></div></div>
<div class="ttc" id="structNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00039">neomutt.h:39</a></div></div>
<div class="ttc" id="mutt_2string_8c_html_a4388c16988fac9a7596dee4d4af89595"><div class="ttname"><a href="mutt_2string_8c.html#a4388c16988fac9a7596dee4d4af89595">mutt_str_asprintf</a></div><div class="ttdeci">int mutt_str_asprintf(char **strp, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2string_8c_source.html#l01128">string.c:1128</a></div></div>
<div class="ttc" id="file_8c_html_ae1c0c19fec03274220b3ca065ad1e2e5"><div class="ttname"><a href="file_8c.html#ae1c0c19fec03274220b3ca065ad1e2e5">mutt_file_fopen</a></div><div class="ttdeci">FILE * mutt_file_fopen(const char *path, const char *mode)</div><div class="ttdoc">Call fopen() safely. </div><div class="ttdef"><b>Definition:</b> <a href="file_8c_source.html#l00589">file.c:589</a></div></div>
</div><!-- fragment --><div id="dynsection-40" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-40-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-40-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-40-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ae0a15dc5df31b626a42f31bd6a5ea7f4_cgraph.svg" width="634" height="740"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-41" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-41-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-41-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-41-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ae0a15dc5df31b626a42f31bd6a5ea7f4_icgraph.svg" width="375" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a93e2f01418ccb7300b9864837c0a2719"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93e2f01418ccb7300b9864837c0a2719">&#9670;&nbsp;</a></span>ssl_verify_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_verify_callback </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>preverify_ok</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">X509_STORE_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Certificate verification callback. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">preverify_ok</td><td>If true, don't question the user if they skipped verification </td></tr>
    <tr><td class="paramname">ctx</td><td>X509 store context </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Certificate is valid </td></tr>
    <tr><td class="paramname">false</td><td>Error, or Certificate is invalid</td></tr>
  </table>
  </dd>
</dl>
<p>Called for each certificate in the chain sent by the peer, starting from the root; returning true means that the given certificate is trusted, returning false immediately aborts the SSL connection </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01004">1004</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;{</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordtype">char</span> buf[256];</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  SSL *ssl = X509_STORE_CTX_get_ex_data(ctx, SSL_get_ex_data_X509_STORE_CTX_idx());</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keywordflow">if</span> (!ssl)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  {</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>,</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;               <span class="stringliteral">&quot;failed to retrieve SSL structure from X509_STORE_CTX\n&quot;</span>);</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  }</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *host = SSL_get_ex_data(ssl, <a class="code" href="openssl_8c.html#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a>);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="keywordflow">if</span> (!host)</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  {</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;failed to retrieve hostname from SSL structure\n&quot;</span>);</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  }</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <span class="comment">/* This is true when a previous entry in the certificate chain did</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">   * not verify and the user manually chose to skip it via the</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">   * $ssl_verify_partial_chains option.</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">   * In this case, all following certificates need to be treated as non-verified</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">   * until one is actually verified.  */</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordtype">bool</span> skip_mode = (SSL_get_ex_data(ssl, <a class="code" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>));</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  X509 *cert = X509_STORE_CTX_get_current_cert(ctx);</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordtype">int</span> pos = X509_STORE_CTX_get_error_depth(ctx);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordtype">size_t</span> len = sk_X509_num(X509_STORE_CTX_get0_chain(ctx));</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;checking cert chain entry %s (preverify: %d skipmode: %d)\n&quot;</span>,</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;             X509_NAME_oneline(X509_get_subject_name(cert), buf, <span class="keyword">sizeof</span>(buf)),</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;             preverify_ok, skip_mode);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="preprocessor">#ifdef HAVE_SSL_PARTIAL_CHAIN</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="comment">/* Sometimes, when a certificate is (s)kipped, OpenSSL will pass it</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">   * a second time with preverify_ok = 1.  Don&#39;t show it or the user</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">   * will think their &quot;s&quot; key is broken.  */</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_verify_partial_chains =</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_verify_partial_chains&quot;</span>);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keywordflow">if</span> (c_ssl_verify_partial_chains)</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  {</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> last_pos = 0;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keyword">static</span> X509 *last_cert = NULL;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">if</span> (skip_mode &amp;&amp; preverify_ok &amp;&amp; (pos == last_pos) &amp;&amp; last_cert)</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> last_cert_md[EVP_MAX_MD_SIZE];</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> last_cert_mdlen;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <span class="keywordflow">if</span> (X509_digest(last_cert, EVP_sha256(), last_cert_md, &amp;last_cert_mdlen) &amp;&amp;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;          <a class="code" href="openssl_8c.html#a4beebc53c57442012424fe2dcfcada63">compare_certificates</a>(cert, last_cert, last_cert_md, last_cert_mdlen))</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      {</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;ignoring duplicate skipped certificate\n&quot;</span>);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      }</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    }</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    last_pos = pos;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">if</span> (last_cert)</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      X509_free(last_cert);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    last_cert = X509_dup(cert);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  }</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="comment">/* check session cache first */</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="openssl_8c.html#a5f1104e3e22a4015529223f2288398f3">check_certificate_cache</a>(cert))</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;using cached certificate\n&quot;</span>);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    SSL_set_ex_data(ssl, <a class="code" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, NULL);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  }</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="comment">/* check hostname only for the leaf certificate */</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  buf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_verify_host =</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_verify_host&quot;</span>);</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keywordflow">if</span> ((pos == 0) &amp;&amp; (c_ssl_verify_host != <a class="code" href="quad_8h.html#a738f558a271fe5035e0ee3b700ee35dbabe3800cc419f25384aaf1892fc3c812b">MUTT_NO</a>))</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  {</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="openssl_8c.html#a039081100802f18e9d2fb80b492e61ac">check_host</a>(cert, host, buf, <span class="keyword">sizeof</span>(buf)) == 0)</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    {</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Certificate host check failed: %s&quot;</span>), buf);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      <span class="comment">/* we disallow (a)ccept always in the prompt, because it will have no effect</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">       * for hostname mismatches. */</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="openssl_8c.html#ae0a15dc5df31b626a42f31bd6a5ea7f4">interactive_check_cert</a>(cert, pos, len, ssl, <span class="keyword">false</span>);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    }</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;hostname check passed\n&quot;</span>);</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  }</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keywordflow">if</span> (!preverify_ok || skip_mode)</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  {</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">/* automatic check from user&#39;s database */</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_certificate_file =</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <a class="code" href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;certificate_file&quot;</span>);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keywordflow">if</span> (c_certificate_file &amp;&amp; <a class="code" href="openssl_8c.html#afdbe2b83fcf6173cf72e7f729f230a72">check_certificate_by_digest</a>(cert))</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;digest check passed\n&quot;</span>);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      SSL_set_ex_data(ssl, <a class="code" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, NULL);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    }</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="comment">/* log verification error */</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordtype">int</span> err = X509_STORE_CTX_get_error(ctx);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%s (%d)&quot;</span>, X509_verify_cert_error_string(err), err);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a>, <span class="stringliteral">&quot;X509_verify_cert: %s\n&quot;</span>, buf);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="comment">/* prompt user */</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="openssl_8c.html#ae0a15dc5df31b626a42f31bd6a5ea7f4">interactive_check_cert</a>(cert, pos, len, ssl, <span class="keyword">true</span>);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  }</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;}</div><div class="ttc" id="helpers_8c_html_ae50f679dd6c5bd1ba820884c8602f038"><div class="ttname"><a href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a></div><div class="ttdeci">bool cs_subset_bool(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a boolean config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00073">helpers.c:73</a></div></div>
<div class="ttc" id="group__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00088">logging.h:88</a></div></div>
<div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="openssl_8c_html_a4beebc53c57442012424fe2dcfcada63"><div class="ttname"><a href="openssl_8c.html#a4beebc53c57442012424fe2dcfcada63">compare_certificates</a></div><div class="ttdeci">static bool compare_certificates(X509 *cert, X509 *peercert, unsigned char *peermd, unsigned int peermdlen)</div><div class="ttdoc">Compare two X509 certificated. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00440">openssl.c:440</a></div></div>
<div class="ttc" id="structNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00036">neomutt.h:36</a></div></div>
<div class="ttc" id="openssl_8c_html_ae0a15dc5df31b626a42f31bd6a5ea7f4"><div class="ttname"><a href="openssl_8c.html#ae0a15dc5df31b626a42f31bd6a5ea7f4">interactive_check_cert</a></div><div class="ttdeci">static bool interactive_check_cert(X509 *cert, int idx, size_t len, SSL *ssl, bool allow_always)</div><div class="ttdoc">Ask the user if a certificate is valid. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00898">openssl.c:898</a></div></div>
<div class="ttc" id="openssl_8c_html_a5f1104e3e22a4015529223f2288398f3"><div class="ttname"><a href="openssl_8c.html#a5f1104e3e22a4015529223f2288398f3">check_certificate_cache</a></div><div class="ttdeci">static bool check_certificate_cache(X509 *peercert)</div><div class="ttdoc">Is the X509 Certificate in the cache? </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00643">openssl.c:643</a></div></div>
<div class="ttc" id="openssl_8c_html_a039081100802f18e9d2fb80b492e61ac"><div class="ttname"><a href="openssl_8c.html#a039081100802f18e9d2fb80b492e61ac">check_host</a></div><div class="ttdeci">static int check_host(X509 *x509cert, const char *hostname, char *err, size_t errlen)</div><div class="ttdoc">Check the host on the certificate. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00719">openssl.c:719</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab02ab1e1ebe44a7ad67c0d6cf0447be3">LL_DEBUG2</a></div><div class="ttdoc">Log at debug level 2. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00041">logging.h:41</a></div></div>
<div class="ttc" id="openssl_8c_html_afdbe2b83fcf6173cf72e7f729f230a72"><div class="ttname"><a href="openssl_8c.html#afdbe2b83fcf6173cf72e7f729f230a72">check_certificate_by_digest</a></div><div class="ttdeci">static bool check_certificate_by_digest(X509 *peercert)</div><div class="ttdoc">Validate a certificate by its digest. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00828">openssl.c:828</a></div></div>
<div class="ttc" id="helpers_8c_html_acadf9e29fd733422508496a70a080c09"><div class="ttname"><a href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00194">helpers.c:194</a></div></div>
<div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a></div><div class="ttdoc">Log at debug level 1. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00040">logging.h:40</a></div></div>
<div class="ttc" id="openssl_8c_html_af84a999f737b3cc63228cecc117a5d87"><div class="ttname"><a href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a></div><div class="ttdeci">static int SkipModeExDataIndex</div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00086">openssl.c:86</a></div></div>
<div class="ttc" id="quad_8h_html_a738f558a271fe5035e0ee3b700ee35dbabe3800cc419f25384aaf1892fc3c812b"><div class="ttname"><a href="quad_8h.html#a738f558a271fe5035e0ee3b700ee35dbabe3800cc419f25384aaf1892fc3c812b">MUTT_NO</a></div><div class="ttdoc">User answered &amp;#39;No&amp;#39;, or assume &amp;#39;No&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="quad_8h_source.html#l00038">quad.h:38</a></div></div>
<div class="ttc" id="structNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00039">neomutt.h:39</a></div></div>
<div class="ttc" id="openssl_8c_html_ab43c12dc4d5c8504c852b18a43ef0f8a"><div class="ttname"><a href="openssl_8c.html#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a></div><div class="ttdeci">static int HostExDataIndex</div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00081">openssl.c:81</a></div></div>
</div><!-- fragment --><div id="dynsection-42" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-42-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-42-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-42-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a93e2f01418ccb7300b9864837c0a2719_cgraph.svg" width="590" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-43" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-43-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-43-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-43-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a93e2f01418ccb7300b9864837c0a2719_icgraph.svg" width="315" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a7480af2397359ace6c8741be1e680295"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7480af2397359ace6c8741be1e680295">&#9670;&nbsp;</a></span>ssl_negotiate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_negotiate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct SslSockData *&#160;</td>
          <td class="paramname"><em>ssldata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Attempt to negotiate SSL over the wire. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a> to a server </td></tr>
    <tr><td class="paramname">ssldata</td><td>SSL socket data </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error</td></tr>
  </table>
  </dd>
</dl>
<p>After SSL state has been initialized, attempt to negotiate SSL over the wire, including certificate checks. </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01124">1124</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;{</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="keywordtype">int</span> err;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *errmsg = NULL;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <a class="code" href="openssl_8c.html#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a> = SSL_get_ex_new_index(0, <span class="stringliteral">&quot;host&quot;</span>, NULL, NULL, NULL);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="openssl_8c.html#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a> == -1)</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  {</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>,</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;               <span class="stringliteral">&quot;#1 failed to get index for application specific data\n&quot;</span>);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  }</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  <span class="keywordflow">if</span> (!SSL_set_ex_data(ssldata-&gt;ssl, <a class="code" href="openssl_8c.html#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a>, conn-&gt;<a class="code" href="structConnection.html#ac3c39549b6611c8eaed2a25573b5c432">account</a>.<a class="code" href="structConnAccount.html#aa440323ef3111e1faaf33f6a57103a3a">host</a>))</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  {</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;#2 failed to save hostname in SSL structure\n&quot;</span>);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  }</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <a class="code" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a> = SSL_get_ex_new_index(0, <span class="stringliteral">&quot;skip&quot;</span>, NULL, NULL, NULL);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a> == -1)</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  {</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>,</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;               <span class="stringliteral">&quot;#3 failed to get index for application specific data\n&quot;</span>);</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  }</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="keywordflow">if</span> (!SSL_set_ex_data(ssldata-&gt;ssl, <a class="code" href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a>, NULL))</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  {</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;#4 failed to save skip mode in SSL structure\n&quot;</span>);</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  }</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  SSL_set_verify(ssldata-&gt;ssl, SSL_VERIFY_PEER, <a class="code" href="openssl_8c.html#a93e2f01418ccb7300b9864837c0a2719">ssl_verify_callback</a>);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  SSL_set_mode(ssldata-&gt;ssl, SSL_MODE_AUTO_RETRY);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  <span class="keywordflow">if</span> (!SSL_set_tlsext_host_name(ssldata-&gt;ssl, conn-&gt;<a class="code" href="structConnection.html#ac3c39549b6611c8eaed2a25573b5c432">account</a>.<a class="code" href="structConnAccount.html#aa440323ef3111e1faaf33f6a57103a3a">host</a>))</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  {</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="comment">/* L10N: This is a warning when trying to set the host name for</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">       TLS Server Name Indication (SNI).  This allows the server to present</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">       the correct certificate if it supports multiple hosts. */</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Warning: unable to set TLS SNI host name&quot;</span>));</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  ERR_clear_error();</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  err = SSL_connect(ssldata-&gt;ssl);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordflow">if</span> (err != 1)</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  {</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">switch</span> (SSL_get_error(ssldata-&gt;ssl, err))</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="keywordflow">case</span> SSL_ERROR_SYSCALL:</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        errmsg = <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;I/O error&quot;</span>);</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      <span class="keywordflow">case</span> SSL_ERROR_SSL:</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        errmsg = ERR_error_string(ERR_get_error(), NULL);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        errmsg = <a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;unknown error&quot;</span>);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    }</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;SSL failed: %s&quot;</span>), errmsg);</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  }</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;}</div><div class="ttc" id="structConnection_html_ac3c39549b6611c8eaed2a25573b5c432"><div class="ttname"><a href="structConnection.html#ac3c39549b6611c8eaed2a25573b5c432">Connection::account</a></div><div class="ttdeci">struct ConnAccount account</div><div class="ttdoc">Account details: username, password, etc. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00036">connection.h:36</a></div></div>
<div class="ttc" id="group__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00088">logging.h:88</a></div></div>
<div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="openssl_8c_html_a93e2f01418ccb7300b9864837c0a2719"><div class="ttname"><a href="openssl_8c.html#a93e2f01418ccb7300b9864837c0a2719">ssl_verify_callback</a></div><div class="ttdeci">static int ssl_verify_callback(int preverify_ok, X509_STORE_CTX *ctx)</div><div class="ttdoc">Certificate verification callback. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01004">openssl.c:1004</a></div></div>
<div class="ttc" id="structConnAccount_html_aa440323ef3111e1faaf33f6a57103a3a"><div class="ttname"><a href="structConnAccount.html#aa440323ef3111e1faaf33f6a57103a3a">ConnAccount::host</a></div><div class="ttdeci">char host[128]</div><div class="ttdoc">Server to login to. </div><div class="ttdef"><b>Definition:</b> <a href="connaccount_8h_source.html#l00053">connaccount.h:53</a></div></div>
<div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a></div><div class="ttdoc">Log at debug level 1. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00040">logging.h:40</a></div></div>
<div class="ttc" id="openssl_8c_html_af84a999f737b3cc63228cecc117a5d87"><div class="ttname"><a href="openssl_8c.html#af84a999f737b3cc63228cecc117a5d87">SkipModeExDataIndex</a></div><div class="ttdeci">static int SkipModeExDataIndex</div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00086">openssl.c:86</a></div></div>
<div class="ttc" id="openssl_8c_html_ab43c12dc4d5c8504c852b18a43ef0f8a"><div class="ttname"><a href="openssl_8c.html#ab43c12dc4d5c8504c852b18a43ef0f8a">HostExDataIndex</a></div><div class="ttdeci">static int HostExDataIndex</div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00081">openssl.c:81</a></div></div>
</div><!-- fragment --><div id="dynsection-44" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-44-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-44-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-44-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a7480af2397359ace6c8741be1e680295_cgraph.svg" width="315" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-45" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-45-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-45-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-45-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a7480af2397359ace6c8741be1e680295_icgraph.svg" width="251" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a3ec5a9ba19a2973ea48b0ea491ce08a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ec5a9ba19a2973ea48b0ea491ce08a1">&#9670;&nbsp;</a></span>sockdata()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct SslSockData* sockdata </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get a <a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a>'s socket data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ptr</td><td>Socket data </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01198">1198</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;{</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="keywordflow">return</span> conn-&gt;<a class="code" href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">sockdata</a>;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;}</div><div class="ttc" id="structConnection_html_a2baa91d494f612c8bf43302bb96543f0"><div class="ttname"><a href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">Connection::sockdata</a></div><div class="ttdeci">void * sockdata</div><div class="ttdoc">Backend-specific socket data. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00042">connection.h:42</a></div></div>
</div><!-- fragment --><div id="dynsection-46" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-46-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-46-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-46-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a3ec5a9ba19a2973ea48b0ea491ce08a1_icgraph.svg" width="271" height="240"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5dd67086d5ccb49018781662b104954e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dd67086d5ccb49018781662b104954e">&#9670;&nbsp;</a></span>ssl_setup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_setup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set up SSL on the <a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01209">1209</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;{</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  <span class="keywordtype">int</span> maxbits = 0;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">sockdata</a> = <a class="code" href="memory_8c.html#a4c1612d209c7825d55e6a014df352f03">mutt_mem_calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> SslSockData));</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx = SSL_CTX_new(SSLv23_client_method());</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx)</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  {</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="comment">/* L10N: an SSL context is a data structure returned by the OpenSSL</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="comment">       function SSL_CTX_new().  In this case it returned NULL: an</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="comment">       error condition.  */</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Unable to create SSL context&quot;</span>));</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <a class="code" href="openssl_8c.html#a8f0e82431c3c3b2f63982217cc0e9f50">ssl_dprint_err_stack</a>();</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordflow">goto</span> free_ssldata;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  }</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <span class="comment">/* disable SSL protocols as needed */</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="preprocessor">#ifdef SSL_OP_NO_TLSv1_3</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_tlsv1_3 =</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_tlsv1_3&quot;</span>);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="keywordflow">if</span> (!c_ssl_use_tlsv1_3)</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    SSL_CTX_set_options(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_TLSv1_3);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="preprocessor">#ifdef SSL_OP_NO_TLSv1_2</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_tlsv1_2 =</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_tlsv1_2&quot;</span>);</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="keywordflow">if</span> (!c_ssl_use_tlsv1_2)</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    SSL_CTX_set_options(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_TLSv1_2);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="preprocessor">#ifdef SSL_OP_NO_TLSv1_1</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_tlsv1_1 =</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_tlsv1_1&quot;</span>);</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordflow">if</span> (!c_ssl_use_tlsv1_1)</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    SSL_CTX_set_options(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_TLSv1_1);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="preprocessor">#ifdef SSL_OP_NO_TLSv1</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_tlsv1 = <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_tlsv1&quot;</span>);</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="keywordflow">if</span> (!c_ssl_use_tlsv1)</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    SSL_CTX_set_options(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_TLSv1);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_sslv3 = <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_sslv3&quot;</span>);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordflow">if</span> (!c_ssl_use_sslv3)</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    SSL_CTX_set_options(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_SSLv3);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_sslv2 = <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_sslv2&quot;</span>);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="keywordflow">if</span> (!c_ssl_use_sslv2)</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    SSL_CTX_set_options(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx, SSL_OP_NO_SSLv2);</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> c_ssl_use_system_certs =</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      <a class="code" href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_use_system_certs&quot;</span>);</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="keywordflow">if</span> (c_ssl_use_system_certs)</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  {</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordflow">if</span> (!SSL_CTX_set_default_verify_paths(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx))</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;Error setting default verify paths\n&quot;</span>);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <span class="keywordflow">goto</span> free_ctx;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    }</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_certificate_file =</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      <a class="code" href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;certificate_file&quot;</span>);</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="keywordflow">if</span> (c_certificate_file &amp;&amp; !<a class="code" href="openssl_8c.html#aebadff6988380fa81412e6c0dc0f6add">ssl_load_certificates</a>(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx))</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <a class="code" href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a>(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a>, <span class="stringliteral">&quot;Error loading trusted certificates\n&quot;</span>);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <a class="code" href="openssl_8c.html#ad249269819bbf126758110522b538d62">ssl_get_client_cert</a>(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn), conn);</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> c_ssl_ciphers =</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <a class="code" href="helpers_8c.html#ac477c591155aa4ae0452bbabc0affffe">cs_subset_string</a>(<a class="code" href="structNeoMutt.html">NeoMutt</a>-&gt;<a class="code" href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">sub</a>, <span class="stringliteral">&quot;ssl_ciphers&quot;</span>);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="keywordflow">if</span> (c_ssl_ciphers)</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  {</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    SSL_CTX_set_cipher_list(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx, c_ssl_ciphers);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  }</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="openssl_8c.html#add4f4eabd8404f14dd429fb02476f6ff">ssl_set_verify_partial</a>(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx))</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  {</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <a class="code" href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a>(<a class="code" href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a>(<span class="stringliteral">&quot;Warning: error enabling ssl_verify_partial_chains&quot;</span>));</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  }</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;ssl = SSL_new(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx);</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  SSL_set_fd(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;ssl, conn-&gt;<a class="code" href="structConnection.html#af805fad417c8fa7c5079ef741d8233e2">fd</a>);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="openssl_8c.html#a7480af2397359ace6c8741be1e680295">ssl_negotiate</a>(conn, <a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)))</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordflow">goto</span> free_ssl;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;isopen = 1;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a577e30cca37f125532cc73d4cbf51dcb">ssf</a> = SSL_CIPHER_get_bits(SSL_get_current_cipher(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;ssl), &amp;maxbits);</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;free_ssl:</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  SSL_free(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;ssl);</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  <a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;ssl = NULL;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;free_ctx:</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  SSL_CTX_free(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx);</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;sctx = NULL;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;free_ssldata:</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <a class="code" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;conn-&gt;<a class="code" href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">sockdata</a>);</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;}</div><div class="ttc" id="memory_8c_html_a4c1612d209c7825d55e6a014df352f03"><div class="ttname"><a href="memory_8c.html#a4c1612d209c7825d55e6a014df352f03">mutt_mem_calloc</a></div><div class="ttdeci">void * mutt_mem_calloc(size_t nmemb, size_t size)</div><div class="ttdoc">Allocate zeroed memory on the heap. </div><div class="ttdef"><b>Definition:</b> <a href="memory_8c_source.html#l00050">memory.c:50</a></div></div>
<div class="ttc" id="openssl_8c_html_a7480af2397359ace6c8741be1e680295"><div class="ttname"><a href="openssl_8c.html#a7480af2397359ace6c8741be1e680295">ssl_negotiate</a></div><div class="ttdeci">static int ssl_negotiate(struct Connection *conn, struct SslSockData *ssldata)</div><div class="ttdoc">Attempt to negotiate SSL over the wire. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01124">openssl.c:1124</a></div></div>
<div class="ttc" id="helpers_8c_html_ae50f679dd6c5bd1ba820884c8602f038"><div class="ttname"><a href="helpers_8c.html#ae50f679dd6c5bd1ba820884c8602f038">cs_subset_bool</a></div><div class="ttdeci">bool cs_subset_bool(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a boolean config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00073">helpers.c:73</a></div></div>
<div class="ttc" id="structConnection_html_a577e30cca37f125532cc73d4cbf51dcb"><div class="ttname"><a href="structConnection.html#a577e30cca37f125532cc73d4cbf51dcb">Connection::ssf</a></div><div class="ttdeci">unsigned int ssf</div><div class="ttdoc">Security strength factor, in bits (see below) </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00037">connection.h:37</a></div></div>
<div class="ttc" id="group__logging__api_html_gacc1fd6d7ab1603e80e11e84e90d061e4"><div class="ttname"><a href="group__logging__api.html#gacc1fd6d7ab1603e80e11e84e90d061e4">mutt_error</a></div><div class="ttdeci">#define mutt_error(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00088">logging.h:88</a></div></div>
<div class="ttc" id="openssl_8c_html_ad249269819bbf126758110522b538d62"><div class="ttname"><a href="openssl_8c.html#ad249269819bbf126758110522b538d62">ssl_get_client_cert</a></div><div class="ttdeci">static void ssl_get_client_cert(struct SslSockData *ssldata, struct Connection *conn)</div><div class="ttdoc">Get the client certificate for an SSL connection. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00606">openssl.c:606</a></div></div>
<div class="ttc" id="structConnection_html_a2baa91d494f612c8bf43302bb96543f0"><div class="ttname"><a href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">Connection::sockdata</a></div><div class="ttdeci">void * sockdata</div><div class="ttdoc">Backend-specific socket data. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00042">connection.h:42</a></div></div>
<div class="ttc" id="openssl_8c_html_aebadff6988380fa81412e6c0dc0f6add"><div class="ttname"><a href="openssl_8c.html#aebadff6988380fa81412e6c0dc0f6add">ssl_load_certificates</a></div><div class="ttdeci">static int ssl_load_certificates(SSL_CTX *ctx)</div><div class="ttdoc">Load certificates and filter out the expired ones. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00116">openssl.c:116</a></div></div>
<div class="ttc" id="mutt_2message_8h_html_a479d658dfd60fe8d9709ec67a58b34ca"><div class="ttname"><a href="mutt_2message_8h.html#a479d658dfd60fe8d9709ec67a58b34ca">_</a></div><div class="ttdeci">#define _(a)</div><div class="ttdef"><b>Definition:</b> <a href="mutt_2message_8h_source.html#l00028">message.h:28</a></div></div>
<div class="ttc" id="openssl_8c_html_a8f0e82431c3c3b2f63982217cc0e9f50"><div class="ttname"><a href="openssl_8c.html#a8f0e82431c3c3b2f63982217cc0e9f50">ssl_dprint_err_stack</a></div><div class="ttdeci">static void ssl_dprint_err_stack(void)</div><div class="ttdoc">Dump the SSL error stack. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00307">openssl.c:307</a></div></div>
<div class="ttc" id="structNeoMutt_html"><div class="ttname"><a href="structNeoMutt.html">NeoMutt</a></div><div class="ttdoc">Container for Accounts, Notifications. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00036">neomutt.h:36</a></div></div>
<div class="ttc" id="structConnection_html_af805fad417c8fa7c5079ef741d8233e2"><div class="ttname"><a href="structConnection.html#af805fad417c8fa7c5079ef741d8233e2">Connection::fd</a></div><div class="ttdeci">int fd</div><div class="ttdoc">Socket file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00040">connection.h:40</a></div></div>
<div class="ttc" id="helpers_8c_html_ac477c591155aa4ae0452bbabc0affffe"><div class="ttname"><a href="helpers_8c.html#ac477c591155aa4ae0452bbabc0affffe">cs_subset_string</a></div><div class="ttdeci">const char * cs_subset_string(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a string config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00317">helpers.c:317</a></div></div>
<div class="ttc" id="helpers_8c_html_acadf9e29fd733422508496a70a080c09"><div class="ttname"><a href="helpers_8c.html#acadf9e29fd733422508496a70a080c09">cs_subset_path</a></div><div class="ttdeci">const char * cs_subset_path(const struct ConfigSubset *sub, const char *name)</div><div class="ttdoc">Get a path config item by name. </div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00194">helpers.c:194</a></div></div>
<div class="ttc" id="group__logging__api_html_gae6c5fd73af3410b2d5e8099f8774c8da"><div class="ttname"><a href="group__logging__api.html#gae6c5fd73af3410b2d5e8099f8774c8da">mutt_debug</a></div><div class="ttdeci">#define mutt_debug(LEVEL,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00085">logging.h:85</a></div></div>
<div class="ttc" id="openssl_8c_html_a3ec5a9ba19a2973ea48b0ea491ce08a1"><div class="ttname"><a href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a></div><div class="ttdeci">static struct SslSockData * sockdata(struct Connection *conn)</div><div class="ttdoc">Get a Connection&amp;#39;s socket data. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01198">openssl.c:1198</a></div></div>
<div class="ttc" id="logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab2c99902c587a013b358149516cceeb5">LL_DEBUG1</a></div><div class="ttdoc">Log at debug level 1. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00040">logging.h:40</a></div></div>
<div class="ttc" id="openssl_8c_html_add4f4eabd8404f14dd429fb02476f6ff"><div class="ttname"><a href="openssl_8c.html#add4f4eabd8404f14dd429fb02476f6ff">ssl_set_verify_partial</a></div><div class="ttdeci">static int ssl_set_verify_partial(SSL_CTX *ctx)</div><div class="ttdoc">Allow verification using partial chains (with no root) </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00166">openssl.c:166</a></div></div>
<div class="ttc" id="memory_8h_html_a25875003b43b81a4302256caa4a13599"><div class="ttname"><a href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a></div><div class="ttdeci">#define FREE(x)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00040">memory.h:40</a></div></div>
<div class="ttc" id="structNeoMutt_html_af98065e32243ce9331f93b7f30247d47"><div class="ttname"><a href="structNeoMutt.html#af98065e32243ce9331f93b7f30247d47">NeoMutt::sub</a></div><div class="ttdeci">struct ConfigSubset * sub</div><div class="ttdoc">Inherited config items. </div><div class="ttdef"><b>Definition:</b> <a href="neomutt_8h_source.html#l00039">neomutt.h:39</a></div></div>
</div><!-- fragment --><div id="dynsection-47" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-47-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-47-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-47-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a5dd67086d5ccb49018781662b104954e_cgraph.svg" width="474" height="494"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-48" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-48-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-48-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-48-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a5dd67086d5ccb49018781662b104954e_icgraph.svg" width="272" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a30f5a89c44c5daba9413290a83abdd9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30f5a89c44c5daba9413290a83abdd9c">&#9670;&nbsp;</a></span>ssl_socket_poll()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_socket_poll </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>wait_secs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check whether a socket read would block - Implements <a class="el" href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f" title="Check whether a socket read would block. ">Connection::poll()</a> </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01318">1318</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;{</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  <span class="keywordflow">if</span> (!conn)</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  <span class="keywordflow">if</span> (SSL_has_pending(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;ssl))</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="conn_2private_8h.html#a3e4473be79d3294a1be08ab03d3f7eb6">raw_socket_poll</a>(conn, wait_secs);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;}</div><div class="ttc" id="conn_2private_8h_html_a3e4473be79d3294a1be08ab03d3f7eb6"><div class="ttname"><a href="conn_2private_8h.html#a3e4473be79d3294a1be08ab03d3f7eb6">raw_socket_poll</a></div><div class="ttdeci">int raw_socket_poll(struct Connection *conn, time_t wait_secs)</div><div class="ttdoc">Checks whether reads would block - Implements Connection::poll() </div><div class="ttdef"><b>Definition:</b> <a href="raw_8c_source.html#l00327">raw.c:327</a></div></div>
<div class="ttc" id="openssl_8c_html_a3ec5a9ba19a2973ea48b0ea491ce08a1"><div class="ttname"><a href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a></div><div class="ttdeci">static struct SslSockData * sockdata(struct Connection *conn)</div><div class="ttdoc">Get a Connection&amp;#39;s socket data. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01198">openssl.c:1198</a></div></div>
</div><!-- fragment --><div id="dynsection-49" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-49-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-49-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-49-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a30f5a89c44c5daba9413290a83abdd9c_cgraph.svg" width="307" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-50" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-50-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-50-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-50-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a30f5a89c44c5daba9413290a83abdd9c_icgraph.svg" width="351" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aee6856c134462c191da6659c8b469145"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee6856c134462c191da6659c8b469145">&#9670;&nbsp;</a></span>ssl_socket_open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_socket_open </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Open an SSL socket - Implements <a class="el" href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2" title="Note about ssf: in actuality, NeoMutt uses this as a boolean to determine if the connection is &quot;secur...">Connection::open()</a> </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01332">1332</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;{</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="conn_2private_8h.html#a62c82d391a1fbad8244061b3dacdc57b">raw_socket_open</a>(conn) &lt; 0)</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordtype">int</span> rc = <a class="code" href="openssl_8c.html#a5dd67086d5ccb49018781662b104954e">ssl_setup</a>(conn);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordflow">if</span> (rc)</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <a class="code" href="conn_2private_8h.html#a7c2227bcc35105dbeab16bec4c3fe3e6">raw_socket_close</a>(conn);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;}</div><div class="ttc" id="conn_2private_8h_html_a7c2227bcc35105dbeab16bec4c3fe3e6"><div class="ttname"><a href="conn_2private_8h.html#a7c2227bcc35105dbeab16bec4c3fe3e6">raw_socket_close</a></div><div class="ttdeci">int raw_socket_close(struct Connection *conn)</div><div class="ttdoc">Close a socket - Implements Connection::close() </div><div class="ttdef"><b>Definition:</b> <a href="raw_8c_source.html#l00365">raw.c:365</a></div></div>
<div class="ttc" id="openssl_8c_html_a5dd67086d5ccb49018781662b104954e"><div class="ttname"><a href="openssl_8c.html#a5dd67086d5ccb49018781662b104954e">ssl_setup</a></div><div class="ttdeci">static int ssl_setup(struct Connection *conn)</div><div class="ttdoc">Set up SSL on the Connection. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01209">openssl.c:1209</a></div></div>
<div class="ttc" id="conn_2private_8h_html_a62c82d391a1fbad8244061b3dacdc57b"><div class="ttname"><a href="conn_2private_8h.html#a62c82d391a1fbad8244061b3dacdc57b">raw_socket_open</a></div><div class="ttdeci">int raw_socket_open(struct Connection *conn)</div><div class="ttdoc">Open a socket - Implements Connection::open() </div><div class="ttdef"><b>Definition:</b> <a href="raw_8c_source.html#l00120">raw.c:120</a></div></div>
</div><!-- fragment --><div id="dynsection-51" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-51-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-51-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-51-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aee6856c134462c191da6659c8b469145_cgraph.svg" width="326" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-52" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-52-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-52-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-52-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aee6856c134462c191da6659c8b469145_icgraph.svg" width="359" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a61b00cd8dc0e66e258ab0d7d9286113e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61b00cd8dc0e66e258ab0d7d9286113e">&#9670;&nbsp;</a></span>ssl_socket_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_socket_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read data from an SSL socket - Implements <a class="el" href="structConnection.html#afdd852b383b3926639ec9132c048590a" title="Read from a socket Connection. ">Connection::read()</a> </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01347">1347</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;{</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <span class="keyword">struct </span>SslSockData *data = <a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn);</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordtype">int</span> rc;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  rc = SSL_read(data-&gt;ssl, buf, count);</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  <span class="keywordflow">if</span> ((rc &lt;= 0) || (errno == EINTR))</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  {</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="keywordflow">if</span> (errno == EINTR)</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    {</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      rc = -1;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    }</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    data-&gt;isopen = 0;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <a class="code" href="openssl_8c.html#ad0eb5f86037e1612ca14cd3a0a87a0dc">ssl_err</a>(data, rc);</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;}</div><div class="ttc" id="openssl_8c_html_ad0eb5f86037e1612ca14cd3a0a87a0dc"><div class="ttname"><a href="openssl_8c.html#ad0eb5f86037e1612ca14cd3a0a87a0dc">ssl_err</a></div><div class="ttdeci">static void ssl_err(struct SslSockData *data, int err)</div><div class="ttdoc">Display an SSL error message. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00238">openssl.c:238</a></div></div>
<div class="ttc" id="openssl_8c_html_a3ec5a9ba19a2973ea48b0ea491ce08a1"><div class="ttname"><a href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a></div><div class="ttdeci">static struct SslSockData * sockdata(struct Connection *conn)</div><div class="ttdoc">Get a Connection&amp;#39;s socket data. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01198">openssl.c:1198</a></div></div>
</div><!-- fragment --><div id="dynsection-53" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-53-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-53-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-53-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a61b00cd8dc0e66e258ab0d7d9286113e_cgraph.svg" width="267" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-54" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-54-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-54-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-54-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a61b00cd8dc0e66e258ab0d7d9286113e_icgraph.svg" width="356" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a40b2b0f0a706d96487919a4b0489026a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40b2b0f0a706d96487919a4b0489026a">&#9670;&nbsp;</a></span>ssl_socket_write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_socket_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Write data to an SSL socket - Implements <a class="el" href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db" title="Write to a socket Connection. ">Connection::write()</a> </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01369">1369</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;{</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="keywordflow">if</span> (!conn || !conn-&gt;<a class="code" href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">sockdata</a> || !buf || (count == 0))</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="keywordtype">int</span> rc = SSL_write(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn)-&gt;ssl, buf, count);</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <span class="keywordflow">if</span> ((rc &lt;= 0) || (errno == EINTR))</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  {</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="keywordflow">if</span> (errno == EINTR)</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    {</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      rc = -1;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    }</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <a class="code" href="openssl_8c.html#ad0eb5f86037e1612ca14cd3a0a87a0dc">ssl_err</a>(<a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn), rc);</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  }</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;}</div><div class="ttc" id="structConnection_html_a2baa91d494f612c8bf43302bb96543f0"><div class="ttname"><a href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">Connection::sockdata</a></div><div class="ttdeci">void * sockdata</div><div class="ttdoc">Backend-specific socket data. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00042">connection.h:42</a></div></div>
<div class="ttc" id="openssl_8c_html_ad0eb5f86037e1612ca14cd3a0a87a0dc"><div class="ttname"><a href="openssl_8c.html#ad0eb5f86037e1612ca14cd3a0a87a0dc">ssl_err</a></div><div class="ttdeci">static void ssl_err(struct SslSockData *data, int err)</div><div class="ttdoc">Display an SSL error message. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00238">openssl.c:238</a></div></div>
<div class="ttc" id="openssl_8c_html_a3ec5a9ba19a2973ea48b0ea491ce08a1"><div class="ttname"><a href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a></div><div class="ttdeci">static struct SslSockData * sockdata(struct Connection *conn)</div><div class="ttdoc">Get a Connection&amp;#39;s socket data. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01198">openssl.c:1198</a></div></div>
</div><!-- fragment --><div id="dynsection-55" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-55-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-55-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-55-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a40b2b0f0a706d96487919a4b0489026a_cgraph.svg" width="271" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-56" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-56-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-56-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-56-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a40b2b0f0a706d96487919a4b0489026a_icgraph.svg" width="360" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aafcc34fa7bf9d54a9323c36761353e6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafcc34fa7bf9d54a9323c36761353e6a">&#9670;&nbsp;</a></span>ssl_socket_close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ssl_socket_close </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Close an SSL connection - Implements <a class="el" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc" title="Close a socket Connection. ">Connection::close()</a> </p>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01390">1390</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;{</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  <span class="keyword">struct </span>SslSockData *data = <a class="code" href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a>(conn);</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="keywordflow">if</span> (data)</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  {</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="keywordflow">if</span> (data-&gt;isopen &amp;&amp; (<a class="code" href="conn_2private_8h.html#a3e4473be79d3294a1be08ab03d3f7eb6">raw_socket_poll</a>(conn, 0) &gt;= 0))</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      SSL_shutdown(data-&gt;ssl);</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    SSL_free(data-&gt;ssl);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    data-&gt;ssl = NULL;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    SSL_CTX_free(data-&gt;sctx);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    data-&gt;sctx = NULL;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <a class="code" href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a>(&amp;conn-&gt;<a class="code" href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">sockdata</a>);</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  }</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="conn_2private_8h.html#a7c2227bcc35105dbeab16bec4c3fe3e6">raw_socket_close</a>(conn);</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;}</div><div class="ttc" id="conn_2private_8h_html_a7c2227bcc35105dbeab16bec4c3fe3e6"><div class="ttname"><a href="conn_2private_8h.html#a7c2227bcc35105dbeab16bec4c3fe3e6">raw_socket_close</a></div><div class="ttdeci">int raw_socket_close(struct Connection *conn)</div><div class="ttdoc">Close a socket - Implements Connection::close() </div><div class="ttdef"><b>Definition:</b> <a href="raw_8c_source.html#l00365">raw.c:365</a></div></div>
<div class="ttc" id="structConnection_html_a2baa91d494f612c8bf43302bb96543f0"><div class="ttname"><a href="structConnection.html#a2baa91d494f612c8bf43302bb96543f0">Connection::sockdata</a></div><div class="ttdeci">void * sockdata</div><div class="ttdoc">Backend-specific socket data. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00042">connection.h:42</a></div></div>
<div class="ttc" id="conn_2private_8h_html_a3e4473be79d3294a1be08ab03d3f7eb6"><div class="ttname"><a href="conn_2private_8h.html#a3e4473be79d3294a1be08ab03d3f7eb6">raw_socket_poll</a></div><div class="ttdeci">int raw_socket_poll(struct Connection *conn, time_t wait_secs)</div><div class="ttdoc">Checks whether reads would block - Implements Connection::poll() </div><div class="ttdef"><b>Definition:</b> <a href="raw_8c_source.html#l00327">raw.c:327</a></div></div>
<div class="ttc" id="openssl_8c_html_a3ec5a9ba19a2973ea48b0ea491ce08a1"><div class="ttname"><a href="openssl_8c.html#a3ec5a9ba19a2973ea48b0ea491ce08a1">sockdata</a></div><div class="ttdeci">static struct SslSockData * sockdata(struct Connection *conn)</div><div class="ttdoc">Get a Connection&amp;#39;s socket data. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01198">openssl.c:1198</a></div></div>
<div class="ttc" id="memory_8h_html_a25875003b43b81a4302256caa4a13599"><div class="ttname"><a href="memory_8h.html#a25875003b43b81a4302256caa4a13599">FREE</a></div><div class="ttdeci">#define FREE(x)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00040">memory.h:40</a></div></div>
</div><!-- fragment --><div id="dynsection-57" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-57-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-57-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-57-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aafcc34fa7bf9d54a9323c36761353e6a_cgraph.svg" width="327" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-58" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-58-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-58-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-58-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_aafcc34fa7bf9d54a9323c36761353e6a_icgraph.svg" width="360" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a23591e82bf992ceb5e62c459fd787b8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23591e82bf992ceb5e62c459fd787b8a">&#9670;&nbsp;</a></span>mutt_ssl_starttls()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mutt_ssl_starttls </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Negotiate TLS over an already opened connection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a> to a server </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01415">1415</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;{</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="openssl_8c.html#ac2e20046425bd97175be33f596af1511">ssl_init</a>())</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="keywordtype">int</span> rc = <a class="code" href="openssl_8c.html#a5dd67086d5ccb49018781662b104954e">ssl_setup</a>(conn);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="comment">/* hmm. watch out if we&#39;re starting TLS over any method other than raw. */</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#afdd852b383b3926639ec9132c048590a">read</a> = <a class="code" href="openssl_8c.html#a61b00cd8dc0e66e258ab0d7d9286113e">ssl_socket_read</a>;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db">write</a> = <a class="code" href="openssl_8c.html#a40b2b0f0a706d96487919a4b0489026a">ssl_socket_write</a>;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">close</a> = <a class="code" href="openssl_8c.html#a580181fa12ad95a66805761f701e7cd2">ssl_socket_close_and_restore</a>;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f">poll</a> = <a class="code" href="openssl_8c.html#a30f5a89c44c5daba9413290a83abdd9c">ssl_socket_poll</a>;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  <span class="keywordflow">return</span> rc;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;}</div><div class="ttc" id="openssl_8c_html_a40b2b0f0a706d96487919a4b0489026a"><div class="ttname"><a href="openssl_8c.html#a40b2b0f0a706d96487919a4b0489026a">ssl_socket_write</a></div><div class="ttdeci">static int ssl_socket_write(struct Connection *conn, const char *buf, size_t count)</div><div class="ttdoc">Write data to an SSL socket - Implements Connection::write() </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01369">openssl.c:1369</a></div></div>
<div class="ttc" id="structConnection_html_afdd852b383b3926639ec9132c048590a"><div class="ttname"><a href="structConnection.html#afdd852b383b3926639ec9132c048590a">Connection::read</a></div><div class="ttdeci">int(* read)(struct Connection *conn, char *buf, size_t count)</div><div class="ttdoc">Read from a socket Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00072">connection.h:72</a></div></div>
<div class="ttc" id="openssl_8c_html_a30f5a89c44c5daba9413290a83abdd9c"><div class="ttname"><a href="openssl_8c.html#a30f5a89c44c5daba9413290a83abdd9c">ssl_socket_poll</a></div><div class="ttdeci">static int ssl_socket_poll(struct Connection *conn, time_t wait_secs)</div><div class="ttdoc">Check whether a socket read would block - Implements Connection::poll() </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01318">openssl.c:1318</a></div></div>
<div class="ttc" id="openssl_8c_html_a5dd67086d5ccb49018781662b104954e"><div class="ttname"><a href="openssl_8c.html#a5dd67086d5ccb49018781662b104954e">ssl_setup</a></div><div class="ttdeci">static int ssl_setup(struct Connection *conn)</div><div class="ttdoc">Set up SSL on the Connection. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01209">openssl.c:1209</a></div></div>
<div class="ttc" id="structConnection_html_a7a40be1f125477cf01ced6817be10bbc"><div class="ttname"><a href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">Connection::close</a></div><div class="ttdeci">int(* close)(struct Connection *conn)</div><div class="ttdoc">Close a socket Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00100">connection.h:100</a></div></div>
<div class="ttc" id="openssl_8c_html_a61b00cd8dc0e66e258ab0d7d9286113e"><div class="ttname"><a href="openssl_8c.html#a61b00cd8dc0e66e258ab0d7d9286113e">ssl_socket_read</a></div><div class="ttdeci">static int ssl_socket_read(struct Connection *conn, char *buf, size_t count)</div><div class="ttdoc">Read data from an SSL socket - Implements Connection::read() </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01347">openssl.c:1347</a></div></div>
<div class="ttc" id="structConnection_html_a2fcded23739f26da564cdb378c8b0a4f"><div class="ttname"><a href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f">Connection::poll</a></div><div class="ttdeci">int(* poll)(struct Connection *conn, time_t wait_secs)</div><div class="ttdoc">Check whether a socket read would block. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00092">connection.h:92</a></div></div>
<div class="ttc" id="openssl_8c_html_ac2e20046425bd97175be33f596af1511"><div class="ttname"><a href="openssl_8c.html#ac2e20046425bd97175be33f596af1511">ssl_init</a></div><div class="ttdeci">static int ssl_init(void)</div><div class="ttdoc">Initialise the SSL library. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00552">openssl.c:552</a></div></div>
<div class="ttc" id="structConnection_html_a3b376a9471b5c0ecf43968239bf8c2db"><div class="ttname"><a href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db">Connection::write</a></div><div class="ttdeci">int(* write)(struct Connection *conn, const char *buf, size_t count)</div><div class="ttdoc">Write to a socket Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00082">connection.h:82</a></div></div>
<div class="ttc" id="openssl_8c_html_a580181fa12ad95a66805761f701e7cd2"><div class="ttname"><a href="openssl_8c.html#a580181fa12ad95a66805761f701e7cd2">ssl_socket_close_and_restore</a></div><div class="ttdeci">static int ssl_socket_close_and_restore(struct Connection *conn)</div><div class="ttdoc">Close an SSL Connection and restore Connection callbacks - Implements Connection::close() ...</div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00627">openssl.c:627</a></div></div>
</div><!-- fragment --><div id="dynsection-59" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-59-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-59-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-59-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_a23591e82bf992ceb5e62c459fd787b8a_cgraph.svg" width="352" height="611"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ae6341b74ebed0751e68285e6bf379fab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6341b74ebed0751e68285e6bf379fab">&#9670;&nbsp;</a></span>mutt_ssl_socket_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mutt_ssl_socket_setup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structConnection.html">Connection</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up SSL socket mulitplexor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td><a class="el" href="structConnection.html" title="An open network connection (socket) ">Connection</a> to a server </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l01437">1437</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;{</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="openssl_8c.html#ac2e20046425bd97175be33f596af1511">ssl_init</a>() &lt; 0)</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  {</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    conn-&gt;<a class="code" href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2">open</a> = <a class="code" href="openssl_8c.html#a6c36f9660a30f073893f32139a8bfa04">ssl_socket_open_err</a>;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2">open</a> = <a class="code" href="openssl_8c.html#aee6856c134462c191da6659c8b469145">ssl_socket_open</a>;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#afdd852b383b3926639ec9132c048590a">read</a> = <a class="code" href="openssl_8c.html#a61b00cd8dc0e66e258ab0d7d9286113e">ssl_socket_read</a>;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db">write</a> = <a class="code" href="openssl_8c.html#a40b2b0f0a706d96487919a4b0489026a">ssl_socket_write</a>;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f">poll</a> = <a class="code" href="openssl_8c.html#a30f5a89c44c5daba9413290a83abdd9c">ssl_socket_poll</a>;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  conn-&gt;<a class="code" href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">close</a> = <a class="code" href="openssl_8c.html#aafcc34fa7bf9d54a9323c36761353e6a">ssl_socket_close</a>;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;}</div><div class="ttc" id="openssl_8c_html_a6c36f9660a30f073893f32139a8bfa04"><div class="ttname"><a href="openssl_8c.html#a6c36f9660a30f073893f32139a8bfa04">ssl_socket_open_err</a></div><div class="ttdeci">static int ssl_socket_open_err(struct Connection *conn)</div><div class="ttdoc">Error callback for opening an SSL connection - Implements Connection::open() </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00355">openssl.c:355</a></div></div>
<div class="ttc" id="openssl_8c_html_a40b2b0f0a706d96487919a4b0489026a"><div class="ttname"><a href="openssl_8c.html#a40b2b0f0a706d96487919a4b0489026a">ssl_socket_write</a></div><div class="ttdeci">static int ssl_socket_write(struct Connection *conn, const char *buf, size_t count)</div><div class="ttdoc">Write data to an SSL socket - Implements Connection::write() </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01369">openssl.c:1369</a></div></div>
<div class="ttc" id="structConnection_html_afdd852b383b3926639ec9132c048590a"><div class="ttname"><a href="structConnection.html#afdd852b383b3926639ec9132c048590a">Connection::read</a></div><div class="ttdeci">int(* read)(struct Connection *conn, char *buf, size_t count)</div><div class="ttdoc">Read from a socket Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00072">connection.h:72</a></div></div>
<div class="ttc" id="openssl_8c_html_a30f5a89c44c5daba9413290a83abdd9c"><div class="ttname"><a href="openssl_8c.html#a30f5a89c44c5daba9413290a83abdd9c">ssl_socket_poll</a></div><div class="ttdeci">static int ssl_socket_poll(struct Connection *conn, time_t wait_secs)</div><div class="ttdoc">Check whether a socket read would block - Implements Connection::poll() </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01318">openssl.c:1318</a></div></div>
<div class="ttc" id="structConnection_html_ad015a1227002b6ae42d5ad0d3add33d2"><div class="ttname"><a href="structConnection.html#ad015a1227002b6ae42d5ad0d3add33d2">Connection::open</a></div><div class="ttdeci">int(* open)(struct Connection *conn)</div><div class="ttdoc">Note about ssf: in actuality, NeoMutt uses this as a boolean to determine if the connection is &quot;secur...</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00062">connection.h:62</a></div></div>
<div class="ttc" id="structConnection_html_a7a40be1f125477cf01ced6817be10bbc"><div class="ttname"><a href="structConnection.html#a7a40be1f125477cf01ced6817be10bbc">Connection::close</a></div><div class="ttdeci">int(* close)(struct Connection *conn)</div><div class="ttdoc">Close a socket Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00100">connection.h:100</a></div></div>
<div class="ttc" id="openssl_8c_html_a61b00cd8dc0e66e258ab0d7d9286113e"><div class="ttname"><a href="openssl_8c.html#a61b00cd8dc0e66e258ab0d7d9286113e">ssl_socket_read</a></div><div class="ttdeci">static int ssl_socket_read(struct Connection *conn, char *buf, size_t count)</div><div class="ttdoc">Read data from an SSL socket - Implements Connection::read() </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01347">openssl.c:1347</a></div></div>
<div class="ttc" id="structConnection_html_a2fcded23739f26da564cdb378c8b0a4f"><div class="ttname"><a href="structConnection.html#a2fcded23739f26da564cdb378c8b0a4f">Connection::poll</a></div><div class="ttdeci">int(* poll)(struct Connection *conn, time_t wait_secs)</div><div class="ttdoc">Check whether a socket read would block. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00092">connection.h:92</a></div></div>
<div class="ttc" id="openssl_8c_html_ac2e20046425bd97175be33f596af1511"><div class="ttname"><a href="openssl_8c.html#ac2e20046425bd97175be33f596af1511">ssl_init</a></div><div class="ttdeci">static int ssl_init(void)</div><div class="ttdoc">Initialise the SSL library. </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l00552">openssl.c:552</a></div></div>
<div class="ttc" id="structConnection_html_a3b376a9471b5c0ecf43968239bf8c2db"><div class="ttname"><a href="structConnection.html#a3b376a9471b5c0ecf43968239bf8c2db">Connection::write</a></div><div class="ttdeci">int(* write)(struct Connection *conn, const char *buf, size_t count)</div><div class="ttdoc">Write to a socket Connection. </div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00082">connection.h:82</a></div></div>
<div class="ttc" id="openssl_8c_html_aee6856c134462c191da6659c8b469145"><div class="ttname"><a href="openssl_8c.html#aee6856c134462c191da6659c8b469145">ssl_socket_open</a></div><div class="ttdeci">static int ssl_socket_open(struct Connection *conn)</div><div class="ttdoc">Open an SSL socket - Implements Connection::open() </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01332">openssl.c:1332</a></div></div>
<div class="ttc" id="openssl_8c_html_aafcc34fa7bf9d54a9323c36761353e6a"><div class="ttname"><a href="openssl_8c.html#aafcc34fa7bf9d54a9323c36761353e6a">ssl_socket_close</a></div><div class="ttdeci">static int ssl_socket_close(struct Connection *conn)</div><div class="ttdoc">Close an SSL connection - Implements Connection::close() </div><div class="ttdef"><b>Definition:</b> <a href="openssl_8c_source.html#l01390">openssl.c:1390</a></div></div>
</div><!-- fragment --><div id="dynsection-60" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-60-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-60-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-60-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="openssl_8c_ae6341b74ebed0751e68285e6bf379fab_cgraph.svg" width="562" height="646"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab43c12dc4d5c8504c852b18a43ef0f8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab43c12dc4d5c8504c852b18a43ef0f8a">&#9670;&nbsp;</a></span>HostExDataIndex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int HostExDataIndex = -1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00081">81</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>

</div>
</div>
<a id="af84a999f737b3cc63228cecc117a5d87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af84a999f737b3cc63228cecc117a5d87">&#9670;&nbsp;</a></span>SkipModeExDataIndex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int SkipModeExDataIndex = -1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="openssl_8c_source.html#l00086">86</a> of file <a class="el" href="openssl_8c_source.html">openssl.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
</body>
</html>
